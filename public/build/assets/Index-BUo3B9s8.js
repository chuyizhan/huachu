import{d as W,r as p,c as K,o as f,w as s,a,b as e,e as r,h as X,y as Y,f as n,t as d,k as g,m as Z,p as w,i as _,F as L,s as j,q as c,n as q,l as z}from"./app-DkNiYRK8.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-VpnKD0GS.js";import{_ as M,a as B}from"./CardContent.vue_vue_type_script_setup_true_lang-B2SM8mp5.js";import{_ as F}from"./CardDescription.vue_vue_type_script_setup_true_lang-BfcpL7Gk.js";import{_ as N}from"./CardHeader.vue_vue_type_script_setup_true_lang-Oq2Pdhy-.js";import{_ as te,a as oe,b as E,c as b,d as re,e as y}from"./TableRow.vue_vue_type_script_setup_true_lang-DDRRtGgx.js";import{_ as se}from"./index-DWHbkIXF.js";import{P as ae}from"./plus-D5lcER5v.js";import"./Primitive-BpC2FDRO.js";import"./useForwardExpose-BrBf3rEh.js";import"./usePrimitiveElement-1pRVe-h1.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-C_qH3ARQ.js";import"./createLucideIcon-CtFEGTlh.js";import"./RovingFocusGroup-0F3Kxr8T.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-C5W0E7bH.js";import"./VisuallyHidden-Ci31Iu08.js";import"./index-LlPNXYK1.js";import"./DialogTitle-Bqfp_-8l.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Dmd4zOUi.js";import"./shield-BpcHX8w-.js";import"./file-text-BKviLtec.js";import"./trending-up-D9S1wKMz.js";import"./book-open-DqPWx8Ge.js";import"./chevron-right-XTzyhvOt.js";const le={class:"py-12"},de={class:"w-full sm:px-6 lg:px-8"},ne={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800"},ie={class:"p-6 text-gray-900 dark:text-gray-100"},ue={class:"mb-6 flex items-center justify-between"},pe={class:"grid gap-4 md:grid-cols-4 mb-6"},ge={class:"text-2xl font-bold"},fe={class:"text-2xl font-bold text-green-600"},ve={class:"text-2xl font-bold text-blue-600"},be={class:"text-2xl font-bold text-red-600"},ye={class:"mb-6 space-y-4"},me={class:"flex flex-wrap gap-4"},_e={class:"flex-1 min-w-[200px]"},ce={class:"min-w-[200px]"},xe=["value"],ke={class:"min-w-[120px]"},we={class:"min-w-[150px]"},he=["value"],Ce={class:"flex flex-wrap gap-4"},$e={class:"min-w-[120px]"},Ve={class:"min-w-[120px]"},Ue={class:"min-w-[150px]"},Se={class:"min-w-[150px]"},De={class:"min-w-[150px]"},Te={class:"flex flex-wrap gap-4"},Pe={class:"min-w-[150px]"},Ie={class:"min-w-[120px]"},Me={class:"min-w-[120px]"},Be={class:"overflow-x-auto"},Fe={class:"space-y-1"},Ne={class:"font-medium"},Le={class:"text-sm text-gray-500 dark:text-gray-400"},je={key:0,class:"text-sm"},ze={class:"text-gray-500 dark:text-gray-400"},Ae={key:1,class:"text-gray-400"},Ke=["onClick"],qe={class:"mt-6 flex items-center justify-between"},Ee={class:"text-sm text-gray-700 dark:text-gray-300"},Ge={class:"flex gap-2"},He=["disabled"],Je={class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300"},Oe=["disabled"],xt=W({__name:"Index",props:{transactions:{},users:{},reasons:{},stats:{},filters:{}},setup(G){const u=G,h=p(u.filters.search||""),C=p(u.filters.user_id||""),$=p(u.filters.type||""),V=p(u.filters.reason||""),U=p(u.filters.points_min||""),S=p(u.filters.points_max||""),D=p(u.filters.date_from||""),T=p(u.filters.date_to||""),P=p(u.filters.related_type||""),m=p(u.filters.sort_by||"created_at"),v=p(u.filters.sort_direction||"desc"),I=p(u.filters.per_page||20),i=()=>{z.get("/admin/point-transactions",{search:h.value||void 0,user_id:C.value||void 0,type:$.value||void 0,reason:V.value||void 0,points_min:U.value||void 0,points_max:S.value||void 0,date_from:D.value||void 0,date_to:T.value||void 0,related_type:P.value||void 0,sort_by:m.value,sort_direction:v.value,per_page:I.value},{preserveState:!0,preserveScroll:!0})},H=()=>{h.value="",C.value="",$.value="",V.value="",U.value="",S.value="",D.value="",T.value="",P.value="",m.value="created_at",v.value="desc",I.value=20,i()},x=l=>{m.value===l?v.value=v.value==="asc"?"desc":"asc":(m.value=l,v.value="asc"),i()},k=l=>m.value!==l?"↕":v.value==="asc"?"↑":"↓",J=l=>new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),A=l=>{z.get("/admin/point-transactions",{...u.filters,page:l},{preserveState:!0,preserveScroll:!0})},O=l=>{confirm("确定要删除这个积分交易吗？这将回滚用户积分。")&&z.delete(`/admin/point-transactions/${l}`,{preserveScroll:!0})},Q=l=>({earned:"text-green-800 bg-green-100 dark:bg-green-900 dark:text-green-200",spent:"text-blue-800 bg-blue-100 dark:bg-blue-900 dark:text-blue-200",deducted:"text-red-800 bg-red-100 dark:bg-red-900 dark:text-red-200"})[l]||"text-gray-800 bg-gray-100 dark:bg-gray-700 dark:text-gray-200",R=l=>({earned:"获得",spent:"消费",deducted:"扣除"})[l]||l;return(l,t)=>(f(),K(ee,null,{default:s(()=>[a(r(X),{title:"积分交易管理"}),e("div",le,[e("div",de,[e("div",ne,[e("div",ie,[e("div",ue,[t[20]||(t[20]=e("h1",{class:"text-2xl font-semibold"},"积分交易管理",-1)),a(r(Y),{href:"/admin/point-transactions/create"},{default:s(()=>[a(r(se),null,{default:s(()=>[a(r(ae),{class:"mr-2 h-4 w-4"}),t[19]||(t[19]=n(" 创建交易 ",-1))]),_:1,__:[19]})]),_:1})]),e("div",pe,[a(r(M),null,{default:s(()=>[a(r(N),{class:"pb-2"},{default:s(()=>[a(r(F),null,{default:s(()=>t[21]||(t[21]=[n("总交易数",-1)])),_:1,__:[21]})]),_:1}),a(r(B),null,{default:s(()=>[e("div",ge,d(l.stats.total_transactions),1)]),_:1})]),_:1}),a(r(M),null,{default:s(()=>[a(r(N),{class:"pb-2"},{default:s(()=>[a(r(F),null,{default:s(()=>t[22]||(t[22]=[n("总获得",-1)])),_:1,__:[22]})]),_:1}),a(r(B),null,{default:s(()=>[e("div",fe,"+"+d(l.stats.total_earned),1)]),_:1})]),_:1}),a(r(M),null,{default:s(()=>[a(r(N),{class:"pb-2"},{default:s(()=>[a(r(F),null,{default:s(()=>t[23]||(t[23]=[n("总消费",-1)])),_:1,__:[23]})]),_:1}),a(r(B),null,{default:s(()=>[e("div",ve,d(l.stats.total_spent),1)]),_:1})]),_:1}),a(r(M),null,{default:s(()=>[a(r(N),{class:"pb-2"},{default:s(()=>[a(r(F),null,{default:s(()=>t[24]||(t[24]=[n("总扣除",-1)])),_:1,__:[24]})]),_:1}),a(r(B),null,{default:s(()=>[e("div",be,d(l.stats.total_deducted),1)]),_:1})]),_:1})]),e("div",ye,[e("div",me,[e("div",_e,[g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>h.value=o),type:"text",placeholder:"搜索原因、用户名、邮箱...",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:Z(i,["enter"])},null,544),[[w,h.value]])]),e("div",ce,[g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>C.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},[t[25]||(t[25]=e("option",{value:""},"全部用户",-1)),(f(!0),_(L,null,j(l.users,o=>(f(),_("option",{key:o.id,value:o.id},d(o.name)+" (@"+d(o.login_name)+") ",9,xe))),128))],544),[[c,C.value]])]),e("div",ke,[g(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>$.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},t[26]||(t[26]=[e("option",{value:""},"全部类型",-1),e("option",{value:"earned"},"获得",-1),e("option",{value:"spent"},"消费",-1),e("option",{value:"deducted"},"扣除",-1)]),544),[[c,$.value]])]),e("div",we,[g(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>V.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},[t[27]||(t[27]=e("option",{value:""},"全部原因",-1)),(f(!0),_(L,null,j(l.reasons,o=>(f(),_("option",{key:o,value:o},d(o),9,he))),128))],544),[[c,V.value]])])]),e("div",Ce,[e("div",$e,[g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>U.value=o),type:"number",placeholder:"最小积分",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},null,544),[[w,U.value]])]),e("div",Ve,[g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>S.value=o),type:"number",placeholder:"最大积分",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},null,544),[[w,S.value]])]),e("div",Ue,[g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>D.value=o),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},null,544),[[w,D.value]])]),e("div",Se,[g(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>T.value=o),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},null,544),[[w,T.value]])]),e("div",De,[g(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>P.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},t[28]||(t[28]=[e("option",{value:""},"全部关联",-1),e("option",{value:"App\\Models\\Post"},"帖子",-1),e("option",{value:"App\\Models\\PostPurchase"},"购买",-1)]),544),[[c,P.value]])])]),e("div",Te,[e("div",Pe,[g(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>m.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},t[29]||(t[29]=[e("option",{value:"id"},"ID",-1),e("option",{value:"user_id"},"用户",-1),e("option",{value:"type"},"类型",-1),e("option",{value:"points"},"积分",-1),e("option",{value:"created_at"},"创建时间",-1)]),544),[[c,m.value]])]),e("div",Ie,[g(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>v.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},t[30]||(t[30]=[e("option",{value:"asc"},"升序",-1),e("option",{value:"desc"},"降序",-1)]),544),[[c,v.value]])]),e("div",Me,[g(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>I.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:i},t[31]||(t[31]=[e("option",{value:10},"10 / 页",-1),e("option",{value:20},"20 / 页",-1),e("option",{value:50},"50 / 页",-1),e("option",{value:100},"100 / 页",-1),e("option",{value:200},"200 / 页",-1)]),544),[[c,I.value]])])]),e("div",{class:"flex gap-2"},[e("button",{type:"button",class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:i}," 搜索 "),e("button",{type:"button",class:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",onClick:H}," 重置 ")])]),e("div",Be,[a(r(te),null,{default:s(()=>[a(r(oe),null,{default:s(()=>[a(r(E),null,{default:s(()=>[a(r(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[12]||(t[12]=o=>x("id"))},{default:s(()=>[n(" ID "+d(k("id")),1)]),_:1}),a(r(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[13]||(t[13]=o=>x("user_id"))},{default:s(()=>[n(" 用户 "+d(k("user_id")),1)]),_:1}),a(r(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[14]||(t[14]=o=>x("type"))},{default:s(()=>[n(" 类型 "+d(k("type")),1)]),_:1}),a(r(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[15]||(t[15]=o=>x("points"))},{default:s(()=>[n(" 积分 "+d(k("points")),1)]),_:1}),a(r(b),null,{default:s(()=>t[32]||(t[32]=[n("原因",-1)])),_:1,__:[32]}),a(r(b),null,{default:s(()=>t[33]||(t[33]=[n("关联",-1)])),_:1,__:[33]}),a(r(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[16]||(t[16]=o=>x("created_at"))},{default:s(()=>[n(" 创建时间 "+d(k("created_at")),1)]),_:1}),a(r(b),null,{default:s(()=>t[34]||(t[34]=[n("操作",-1)])),_:1,__:[34]})]),_:1})]),_:1}),a(r(re),null,{default:s(()=>[(f(!0),_(L,null,j(l.transactions.data,o=>(f(),K(r(E),{key:o.id},{default:s(()=>[a(r(y),{class:"font-medium"},{default:s(()=>[n(d(o.id),1)]),_:2},1024),a(r(y),null,{default:s(()=>[e("div",Fe,[e("div",Ne,d(o.user.name),1),e("div",Le," @"+d(o.user.login_name),1)])]),_:2},1024),a(r(y),null,{default:s(()=>[e("span",{class:q(["px-2 py-1 text-xs font-semibold rounded-full",Q(o.type)])},d(R(o.type)),3)]),_:2},1024),a(r(y),null,{default:s(()=>[e("span",{class:q(["font-semibold",{"text-green-600":o.points>0,"text-red-600":o.points<0}])},d(o.points>0?"+":"")+d(o.points),3)]),_:2},1024),a(r(y),null,{default:s(()=>[n(d(o.reason),1)]),_:2},1024),a(r(y),null,{default:s(()=>[o.related_type?(f(),_("div",je,[e("div",ze,d(o.related_type.split("\\").pop()),1),e("div",null,"ID: "+d(o.related_id),1)])):(f(),_("span",Ae,"-"))]),_:2},1024),a(r(y),{class:"text-sm text-gray-500 dark:text-gray-400"},{default:s(()=>[n(d(J(o.created_at)),1)]),_:2},1024),a(r(y),null,{default:s(()=>[e("button",{type:"button",class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",onClick:Qe=>O(o.id)}," 删除 ",8,Ke)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),e("div",qe,[e("div",Ee," 显示 "+d(l.transactions.data.length)+" 条，共 "+d(l.transactions.total)+" 条 ",1),e("div",Ge,[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700",disabled:l.transactions.current_page===1,onClick:t[17]||(t[17]=o=>A(l.transactions.current_page-1))}," 上一页 ",8,He),e("span",Je," 第 "+d(l.transactions.current_page)+" / "+d(l.transactions.last_page)+" 页 ",1),e("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700",disabled:l.transactions.current_page===l.transactions.last_page,onClick:t[18]||(t[18]=o=>A(l.transactions.current_page+1))}," 下一页 ",8,Oe)])])])])])])]),_:1}))}});export{xt as default};
