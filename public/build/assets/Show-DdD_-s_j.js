import{_ as re}from"./WebLayout.vue_vue_type_script_setup_true_lang-D-woEnGy.js";import{_ as $}from"./index-G1C2CR8F.js";import{b as K,a as z,j as Q,_ as T}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-DK07fgD3.js";import{d as ee,L as te,C as H,u as N,l as h,i as r,o,b as t,a as l,f as c,e as s,t as a,w as f,g as W,j as _,F as O,s as Z,c as L,y as q,n as k,r as j,O as I}from"./app-Ca0afq3n.js";import{_ as R}from"./Textarea.vue_vue_type_script_setup_true_lang-BDgXb-2_.js";import{M as se}from"./message-square-CukzN-QP.js";import{c as oe}from"./createLucideIcon-DPfk0LRx.js";import{S as le}from"./square-pen-C0lggFpH.js";import{T as G}from"./trash-2-Dg3DiFNC.js";import{A as ie}from"./arrow-left-DqMUPigQ.js";import{C as ne}from"./calendar-D-Cw1phI.js";import{E as ce}from"./eye-o3dlgIxI.js";import{S as X}from"./star-yHyjgSFV.js";import"./Primitive-CCTnzWDl.js";import"./usePrimitiveElement-B7nxCNRu.js";import"./useForwardExpose-DohNH0gZ.js";import"./RovingFocusGroup-CGclM9bG.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-dW9Vi417.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=oe("ReplyIcon",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=oe("ThumbsUpIcon",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),ue={class:"mt-8"},pe={class:"text-xl font-semibold text-white mb-4 flex items-center gap-2"},fe={key:0,class:"mb-6"},me={class:"flex justify-end"},ve={key:1,class:"mb-6 p-4 bg-[#374151] rounded-lg text-center"},_e={class:"space-y-4"},he={class:"flex items-start gap-3"},ge={class:"flex-1"},xe={class:"flex items-center gap-2 mb-1"},be={class:"font-semibold text-white"},we={class:"text-xs text-[#999999]"},ye={class:"text-xs text-[#999999]"},ke={key:0,class:"space-y-2"},$e={class:"flex gap-2"},Ce={key:1},Ve={class:"text-white mb-2"},Se={class:"flex items-center gap-3 text-sm"},Be=["onClick"],Fe=["onClick"],je=["onClick"],Le={key:2,class:"mt-3"},Pe={class:"flex gap-2"},Ee={key:3,class:"mt-3 space-y-3"},Ie={class:"flex items-start gap-2"},ze={class:"flex-1"},Te={class:"flex items-center gap-2 mb-1"},De={class:"font-semibold text-white text-sm"},Me={class:"text-xs text-[#999999]"},Ue={class:"text-white text-sm"},Ae={class:"flex items-center gap-3 text-xs mt-2"},Ne=["onClick"],qe={key:0,class:"text-center py-8 text-[#999999]"},Re=ee({__name:"Comments",props:{comments:{},commentableType:{},commentableId:{}},setup(D){const m=D,E=te(),g=H(()=>E.props.auth?.user),d=N({commentable_type:m.commentableType,commentable_id:m.commentableId,parent_id:null,content:""}),b=h(null),w=h(null),x=h(""),V=()=>{d.post("/comments",{preserveScroll:!0,onSuccess:()=>{d.reset("content"),d.parent_id=null,b.value=null}})},M=u=>{b.value=u,d.parent_id=u,d.content=""},S=()=>{b.value=null,d.parent_id=null,d.content=""},C=u=>{w.value=u.id,x.value=u.content},U=()=>{w.value=null,x.value=""},B=u=>{N({content:x.value}).put(`/comments/${u}`,{preserveScroll:!0,onSuccess:()=>{w.value=null,x.value=""}})},y=u=>{confirm("确定要删除这条评论吗？")&&N({}).delete(`/comments/${u}`,{preserveScroll:!0})},P=u=>new Date(u).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),F=u=>g.value&&(g.value.id===u.user_id||g.value.is_admin);return(u,i)=>(o(),r("div",ue,[t("h3",pe,[l(s(se),{class:"h-5 w-5"}),c(" 评论 ("+a(u.comments.length)+") ",1)]),g.value?(o(),r("div",fe,[t("form",{onSubmit:W(V,["prevent"]),class:"space-y-3"},[l(R,{modelValue:s(d).content,"onUpdate:modelValue":i[0]||(i[0]=n=>s(d).content=n),onFocus:i[1]||(i[1]=n=>{s(d).parent_id=null,b.value=null}),placeholder:"写下你的评论...",rows:"3",class:"bg-[#374151] border-[#4B5563] text-white",required:""},null,8,["modelValue"]),t("div",me,[l(s($),{type:"submit",disabled:s(d).processing||!s(d).content.trim(),class:"bg-[#ff6e02] hover:bg-orange-600"},{default:f(()=>[c(a(s(d).processing?"发布中...":"发布评论"),1)]),_:1},8,["disabled"])])],32)])):(o(),r("div",ve,i[4]||(i[4]=[t("p",{class:"text-[#999999]"},[t("a",{href:"/login",class:"text-[#ff6e02] hover:underline"},"登录"),c(" 后发表评论 ")],-1)]))),t("div",_e,[(o(!0),r(O,null,Z(u.comments,n=>(o(),r("div",{key:n.id,class:"bg-[#374151] rounded-lg p-4"},[t("div",he,[l(s(T),{class:"h-10 w-10"},{default:f(()=>[n.user.avatar?(o(),L(s(K),{key:0,src:n.user.avatar,alt:n.user.name},null,8,["src","alt"])):_("",!0),l(s(z),{class:"bg-[#ff6e02] text-white"},{default:f(()=>[c(a(s(Q)(n.user.name)),1)]),_:2},1024)]),_:2},1024),t("div",ge,[t("div",xe,[t("span",be,a(n.user.name),1),t("span",we,"@"+a(n.user.login_name),1),t("span",ye,a(P(n.created_at)),1)]),w.value===n.id?(o(),r("div",ke,[l(R,{modelValue:x.value,"onUpdate:modelValue":i[2]||(i[2]=p=>x.value=p),rows:"3",class:"bg-[#4B5563] border-[#6B7280] text-white"},null,8,["modelValue"]),t("div",$e,[l(s($),{size:"sm",onClick:p=>B(n.id),class:"bg-[#ff6e02] hover:bg-orange-600"},{default:f(()=>i[5]||(i[5]=[c(" 保存 ",-1)])),_:2,__:[5]},1032,["onClick"]),l(s($),{size:"sm",variant:"outline",onClick:U,class:"border-[#4B5563] bg-[#374151] text-white"},{default:f(()=>i[6]||(i[6]=[c(" 取消 ",-1)])),_:1,__:[6]})])])):(o(),r("div",Ce,[t("p",Ve,a(n.content),1),t("div",Se,[g.value?(o(),r("button",{key:0,onClick:p=>M(n.id),class:"text-[#999999] hover:text-[#ff6e02] flex items-center gap-1"},[l(s(de),{class:"h-4 w-4"}),i[7]||(i[7]=c(" 回复 ",-1))],8,Be)):_("",!0),F(n)?(o(),r("button",{key:1,onClick:p=>C(n),class:"text-[#999999] hover:text-[#ff6e02] flex items-center gap-1"},[l(s(le),{class:"h-4 w-4"}),i[8]||(i[8]=c(" 编辑 ",-1))],8,Fe)):_("",!0),F(n)?(o(),r("button",{key:2,onClick:p=>y(n.id),class:"text-[#999999] hover:text-red-500 flex items-center gap-1"},[l(s(G),{class:"h-4 w-4"}),i[9]||(i[9]=c(" 删除 ",-1))],8,je)):_("",!0)])])),b.value===n.id?(o(),r("div",Le,[t("form",{onSubmit:W(V,["prevent"]),class:"space-y-2"},[l(R,{modelValue:s(d).content,"onUpdate:modelValue":i[3]||(i[3]=p=>s(d).content=p),placeholder:"写下你的回复...",rows:"2",class:"bg-[#4B5563] border-[#6B7280] text-white",required:""},null,8,["modelValue"]),t("div",Pe,[l(s($),{type:"submit",size:"sm",disabled:s(d).processing,class:"bg-[#ff6e02] hover:bg-orange-600"},{default:f(()=>[c(a(s(d).processing?"回复中...":"回复"),1)]),_:1},8,["disabled"]),l(s($),{type:"button",size:"sm",variant:"outline",onClick:S,class:"border-[#4B5563] bg-[#374151] text-white"},{default:f(()=>i[10]||(i[10]=[c(" 取消 ",-1)])),_:1,__:[10]})])],32)])):_("",!0),n.replies&&n.replies.length>0?(o(),r("div",Ee,[(o(!0),r(O,null,Z(n.replies,p=>(o(),r("div",{key:p.id,class:"bg-[#2d3748] rounded-lg p-3 ml-4 border-l-2 border-[#ff6e02]"},[t("div",Ie,[l(s(T),{class:"h-8 w-8"},{default:f(()=>[p.user.avatar?(o(),L(s(K),{key:0,src:p.user.avatar,alt:p.user.name},null,8,["src","alt"])):_("",!0),l(s(z),{class:"bg-[#ff6e02] text-white text-xs"},{default:f(()=>[c(a(s(Q)(p.user.name)),1)]),_:2},1024)]),_:2},1024),t("div",ze,[t("div",Te,[t("span",De,a(p.user.name),1),t("span",Me,a(P(p.created_at)),1)]),t("p",Ue,a(p.content),1),t("div",Ae,[F(p)?(o(),r("button",{key:0,onClick:A=>y(p.id),class:"text-[#999999] hover:text-red-500 flex items-center gap-1"},[l(s(G),{class:"h-3 w-3"}),i[11]||(i[11]=c(" 删除 ",-1))],8,Ne)):_("",!0)])])])]))),128))])):_("",!0)])])]))),128)),u.comments.length===0?(o(),r("div",qe," 还没有评论，来发表第一条评论吧！ ")):_("",!0)])]))}}),He={class:"min-h-screen bg-[#1c1c1c]"},Oe={class:"px-6 pt-6 pb-4"},Ze={class:"flex flex-col"},Ge={key:0,class:"mb-0"},Je={key:0},Ke=["src"],Qe={key:1,class:"relative"},We={class:"overflow-x-auto flex snap-x snap-mandatory"},Xe=["src"],Ye={key:1,class:"mb-0"},et=["src"],tt={class:"px-6 py-6"},st={class:"flex items-center justify-between gap-4 mb-6"},ot={class:"text-xl font-medium text-[#ff6e02] flex-1"},lt={key:0,class:"flex items-center gap-2"},at={class:"flex items-center gap-1 text-xs text-[#999999] mb-6"},rt={class:"flex items-center justify-between mb-0"},it={class:"flex items-center gap-5"},nt={class:"flex items-center gap-1 text-sm text-white"},ct=["disabled"],dt=["disabled"],ut={class:"flex items-center gap-3"},pt={class:"text-sm text-white"},ft={key:1,class:"flex items-center gap-2"},mt={class:"text-sm text-white"},vt={class:"px-6 py-6"},_t={class:"flex items-center gap-2 mb-6"},ht={key:0,class:"text-white text-sm leading-relaxed whitespace-pre-line mb-8"},gt={key:1,class:"mb-8"},xt={class:"bg-[#374151] border border-[#ff6e02] rounded-lg p-8 text-center"},bt={class:"text-[#999999] mb-6 text-sm"},wt={class:"text-[#ff6e02] font-bold"},yt={key:0,class:"mb-4 text-xs text-[#999999]"},kt={key:1,class:"space-y-4"},$t={class:"text-sm text-[#999999]"},Ct={class:"text-white font-semibold"},Vt={key:1,class:"text-red-400 text-sm"},St={key:2},Bt={class:"flex items-center justify-center gap-20 py-12"},Ft=["disabled"],jt={class:"text-xs text-white"},Lt=["disabled"],Pt={class:"text-xs text-white"},Et={class:"px-6 py-6"},Yt=ee({__name:"Show",props:{post:{},relatedPosts:{},userInteractions:{},canViewContent:{type:Boolean},isLocked:{type:Boolean},isPurchased:{type:Boolean},userCredits:{},commentsCount:{}},setup(D){const m=D;console.log(m.post);const E=te(),g=h(m.userInteractions.liked),d=h(m.post.like_count),b=h(!1),w=h(m.userInteractions.favorited),x=h(!1),V=h(m.userInteractions.following_creator),M=h(m.post.user.creator_profile?.follower_count||0),S=h(!1),C=h(!1),U=h(m.canViewContent),B=h(m.userCredits),y=H(()=>E.props.auth?.user),P=H(()=>y.value&&E.props.auth?.user?.id===m.post.user.id),F=async()=>{if(!y.value){j.visit("/login");return}if(!b.value){b.value=!0;try{const e=await I.post(`/posts/${m.post.id}/like`);e.data.success?(g.value=e.data.liked,d.value=e.data.like_count):(console.error("Failed to toggle like:",e.data.message),alert(e.data.message||"操作失败，请重试"))}catch(e){console.error("Error toggling like:",e),alert(e.response?.data?.message||"网络错误，请重试")}finally{b.value=!1}}},u=async()=>{if(!y.value){j.visit("/login");return}if(!x.value){x.value=!0;try{const e=await I.post(`/posts/${m.post.id}/favorite`);e.data.success?w.value=e.data.favorited:(console.error("Failed to toggle favorite:",e.data.message),alert(e.data.message||"收藏操作失败，请重试"))}catch(e){console.error("Error toggling favorite:",e),alert(e.response?.data?.message||"网络错误，请重试")}finally{x.value=!1}}},i=async()=>{if(!y.value){j.visit("/login");return}if(!m.post.user.creator_profile){alert("该用户没有创作者档案");return}if(!S.value){S.value=!0;try{const e=await I.post(`/creators/${m.post.user.creator_profile.id}/follow`);e.data.success?(V.value=e.data.following,M.value=e.data.followers_count):(console.error("Failed to toggle follow:",e.data.message),alert(e.data.message||"关注操作失败，请重试"))}catch(e){console.error("Error toggling follow:",e),alert(e.response?.data?.message||"网络错误，请重试")}finally{S.value=!1}}},n=e=>e.split(" ").map(v=>v[0]).join("").toUpperCase(),p=async()=>{if(!y.value){j.visit("/login");return}if(!C.value&&confirm(`确定要花费 ${m.post.price} 积分购买此内容吗？`)){C.value=!0;try{const e=await I.post(`/posts/${m.post.id}/purchase`);e.data.success?(U.value=!0,B.value=e.data.remaining_credits,alert(e.data.message),j.reload()):alert(e.data.message||"购买失败")}catch(e){console.error("Purchase error:",e),alert(e.response?.data?.message||"网络错误，请重试")}finally{C.value=!1}}},A=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),ae=()=>{confirm("确定要删除这篇帖子吗？此操作不可恢复。")&&j.delete(`/posts/${m.post.id}`,{onSuccess:()=>{},onError:e=>{alert("删除失败，请重试")}})};return(e,v)=>(o(),L(re,null,{default:f(()=>[t("div",He,[t("div",Oe,[l(s(q),{href:"/",class:"inline-flex items-center text-[#ff6e02] hover:text-[#e55a00] text-sm"},{default:f(()=>[l(s(ie),{class:"w-4 h-4 mr-2"}),v[0]||(v[0]=c(" 返回首页 ",-1))]),_:1,__:[0]})]),t("div",Ze,[e.post.image_urls&&e.post.image_urls.length>0?(o(),r("div",Ge,[e.post.image_urls.length===1?(o(),r("div",Je,[t("img",{src:e.post.image_urls[0].url,alt:"Post image",class:"w-full h-[350px] object-cover"},null,8,Ke)])):(o(),r("div",Qe,[t("div",We,[(o(!0),r(O,null,Z(e.post.image_urls,J=>(o(),r("img",{key:J.id,src:J.url,alt:"Post image",class:"w-full h-[350px] object-cover flex-shrink-0 snap-center"},null,8,Xe))),128))])]))])):_("",!0),e.post.video_urls&&e.post.video_urls.length>0&&e.canViewContent?(o(),r("div",Ye,[t("video",{src:e.post.video_urls[0].url,controls:"",class:"w-full h-[350px] object-cover",preload:"metadata"}," 您的浏览器不支持视频播放 ",8,et)])):_("",!0),t("div",tt,[t("div",st,[t("h1",ot,a(e.post.title),1),P.value?(o(),r("div",lt,[l(s(q),{href:`/posts/${e.post.id}/edit`,class:"text-[#999999] hover:text-[#ff6e02] transition-colors"},{default:f(()=>[l(s(le),{class:"h-4 w-4"})]),_:1},8,["href"]),t("button",{onClick:ae,class:"text-red-400 hover:text-red-300 transition-colors"},[l(s(G),{class:"h-4 w-4"})])])):_("",!0)]),t("div",at,[l(s(ne),{class:"w-4 h-4"}),t("span",null,a(A(e.post.published_at)),1)]),t("div",rt,[t("div",it,[t("span",nt,[l(s(ce),{class:"w-4 h-4"}),c(" "+a(e.post.view_count),1)]),t("button",{onClick:F,disabled:b.value,class:k(["flex items-center gap-1 text-sm transition-colors",g.value?"text-[#ff6e02]":"text-white"])},[l(s(Y),{class:k(["w-4 h-4",g.value?"fill-current":""])},null,8,["class"]),c(" "+a(d.value),1)],10,ct),t("button",{onClick:u,disabled:x.value,class:k(["flex items-center gap-1 text-sm transition-colors",w.value?"text-[#ff6e02]":"text-white"])},[l(s(X),{class:k(["w-4 h-4",w.value?"fill-current":""])},null,8,["class"]),c(" "+a(e.post.like_count),1)],10,dt)]),t("div",ut,[e.post.user.creator_profile?(o(),L(s(q),{key:0,href:`/creators/${e.post.user.creator_profile.id}`,class:"flex items-center gap-2"},{default:f(()=>[l(s(T),{class:"w-8 h-8"},{default:f(()=>[l(s(z),{class:"bg-[#374151] text-white text-xs"},{default:f(()=>[c(a(n(e.post.user.creator_profile.display_name)),1)]),_:1})]),_:1}),t("span",pt,a(e.post.user.creator_profile.display_name),1)]),_:1},8,["href"])):(o(),r("div",ft,[l(s(T),{class:"w-8 h-8"},{default:f(()=>[l(s(z),{class:"bg-[#374151] text-white text-xs"},{default:f(()=>[c(a(n(e.post.user.name)),1)]),_:1})]),_:1}),t("span",mt,a(e.post.user.name),1)])),e.post.user.creator_profile&&!P.value?(o(),L(s($),{key:2,size:"sm",onClick:i,disabled:S.value,class:k([V.value?"bg-[#999999] text-white hover:bg-[#777777]":"bg-transparent border border-[#999999] text-[#999999] hover:bg-[#999999] hover:text-white","text-xs px-3 py-1 rounded-full transition-colors"])},{default:f(()=>[c(a(V.value?"已关注":"未关注"),1)]),_:1},8,["disabled","class"])):_("",!0)])])]),t("div",vt,[t("div",_t,[l(s(se),{class:"w-5 h-5 text-[#ff6e02]"}),v[1]||(v[1]=t("h2",{class:"text-xl font-medium text-[#ff6e02]"},"详情内容",-1))]),e.canViewContent?(o(),r("div",ht,a(e.post.content),1)):e.isLocked?(o(),r("div",gt,[t("div",xt,[v[6]||(v[6]=t("div",{class:"text-6xl mb-4"},"🔒",-1)),v[7]||(v[7]=t("h3",{class:"text-xl font-bold text-white mb-2"},"此内容需要付费解锁",-1)),t("p",bt,[v[2]||(v[2]=c(" 作者设置此内容需要 ",-1)),t("span",wt,a(e.post.price),1),v[3]||(v[3]=c(" 金币才能查看 ",-1))]),e.post.free_after?(o(),r("div",yt," ⏰ 将在 "+a(A(e.post.free_after))+" 后免费开放 ",1)):_("",!0),y.value?(o(),r("div",kt,[t("div",$t,[v[4]||(v[4]=c(" 你的金币余额: ",-1)),t("span",Ct,a(B.value),1)]),B.value>=e.post.price?(o(),L(s($),{key:0,onClick:p,disabled:C.value,class:"w-full bg-[#ff6e02] hover:bg-[#e55a00] text-white h-12 rounded-lg"},{default:f(()=>[c(a(C.value?"购买中...":`立即购买 ( 金币：${e.post.price} )`),1)]),_:1},8,["disabled"])):(o(),r("div",Vt," 金币不足，需要 "+a(e.post.price-B.value)+" 更多金币 ",1))])):(o(),r("div",St,[l(s($),{as:"a",href:"/login",class:"w-full bg-[#ff6e02] hover:bg-[#e55a00] text-white h-12 rounded-lg"},{default:f(()=>v[5]||(v[5]=[c(" 登录后购买 ",-1)])),_:1,__:[5]})]))])])):_("",!0)]),t("div",Bt,[t("button",{onClick:F,disabled:b.value,class:k(["flex flex-col items-center justify-center w-32 h-32 rounded-full transition-colors",g.value?"bg-[#ff6e02]":"bg-[#374151]"])},[l(s(Y),{class:k(["w-5 h-5 mb-1",g.value?"text-white fill-current":"text-white"])},null,8,["class"]),t("span",jt,a(g.value?"已点赞":"点赞"),1)],10,Ft),t("button",{onClick:u,disabled:x.value,class:k(["flex flex-col items-center justify-center w-32 h-32 rounded-full transition-colors",w.value?"bg-[#ff6e02]":"bg-[#374151]"])},[l(s(X),{class:k(["w-5 h-5 mb-1",w.value?"text-white fill-current":"text-white"])},null,8,["class"]),t("span",Pt,a(w.value?"已收藏":"收藏"),1)],10,Lt)]),t("div",Et,[l(Re,{comments:e.post.comments||[],"commentable-type":"App\\Models\\Post","commentable-id":e.post.id},null,8,["comments","commentable-id"])])])])]),_:1}))}});export{Yt as default};
