import{d as P,r as k,u as R,c as q,o as n,w as l,a as o,b as t,e,h as z,f as d,g as E,i as u,j as f,t as m,n as _,k as v,s as C,v as w,l as B}from"./app-yffFBDxN.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-DEgT0cSW.js";import{_ as x}from"./index-BUy6U1QF.js";import{_ as g}from"./Input.vue_vue_type_script_setup_true_lang-BB0g4myt.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-C9t8auSr.js";import{_ as I,a as L}from"./CardContent.vue_vue_type_script_setup_true_lang-CfxFDWBd.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-D3I2TYCE.js";import{_ as h}from"./CardHeader.vue_vue_type_script_setup_true_lang-NJj_yLcW.js";import{_ as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-zQ1Vv_nJ.js";import{A as W}from"./arrow-left-PCupHVsx.js";import{U as M}from"./upload-m2kF_0wD.js";import{X}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-0fvJFrcD.js";import{R as H}from"./refresh-cw-Dv7KYzy-.js";import"./Primitive-w7CM4taK.js";import"./useForwardExpose-CxeLvbXy.js";import"./usePrimitiveElement-BWfxx9vH.js";import"./RovingFocusGroup-zj6r8tx-.js";import"./VisuallyHidden-Bx66x0IU.js";import"./index-Dhw7ndGb.js";import"./createLucideIcon-CGMjwqEZ.js";import"./DialogTitle-D9BsmiFB.js";import"./index-hb5zdG9_.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CD5v1c27.js";import"./shield-t0Sah5Mq.js";import"./trending-up-Dza009P0.js";import"./file-text-BSSGBlt-.js";import"./chevron-right-DSs2R_WN.js";import"./useArrowNavigation-C6Y-ieo6.js";const K={class:"py-12"},O={class:"w-full sm:px-6 lg:px-8"},Q={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800"},Y={class:"p-6 text-gray-900 dark:text-gray-100"},Z={class:"mb-6 flex items-center justify-between"},ee={class:"flex items-center gap-4"},se={class:"space-y-4"},re={class:"space-y-2"},te={class:"flex items-start gap-4"},oe={class:"relative"},ae={key:0,class:"w-24 h-24 rounded-full overflow-hidden border-2 border-gray-300 dark:border-gray-600"},le=["src"],de={key:1,class:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-2 border-gray-300 dark:border-gray-600"},ie={class:"flex-1"},ne={for:"avatar",class:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer"},ue={key:0,class:"text-sm text-red-500"},me={class:"space-y-2"},pe={key:0,class:"text-sm text-red-500"},fe={class:"space-y-2"},_e={key:0,class:"text-sm text-red-500"},ge={class:"space-y-2"},ye={key:0,class:"text-sm text-red-500"},ce={class:"space-y-2"},be={key:0,class:"text-sm text-red-500"},ve={class:"space-y-2"},xe={key:0,class:"text-sm text-red-500"},ke={class:"space-y-4 pt-6 border-t"},we={class:"space-y-2"},Ve={key:0,class:"text-sm text-red-500"},Ue={class:"space-y-2"},$e={key:0,class:"text-sm text-red-500"},Ce={class:"space-y-2"},Be={key:0,class:"text-sm text-red-500"},Me={class:"space-y-2"},Se={key:0,class:"text-sm text-red-500"},Ae={class:"space-y-4 pt-6 border-t"},De={class:"flex items-center space-x-2"},Fe={class:"flex items-center space-x-2"},Ne={class:"flex items-center space-x-2"},je={class:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg"},Pe={class:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},Re={class:"font-semibold"},qe={class:"flex gap-4"},ps=P({__name:"Edit",props:{user:{}},setup(S){const i=S,b=k(i.user.avatar?`/storage/${i.user.avatar}`:null),V=k(null),r=R({name:i.user.name,email:i.user.email,login_name:i.user.login_name,password:"",password_confirmation:"",is_creator:i.user.is_creator,is_verified:i.user.is_verified,is_top_creator:i.user.is_top_creator,type:i.user.type,status:i.user.status,credits:i.user.credits,balance:i.user.balance,avatar:null,remove_avatar:!1}),A=c=>{const a=c.target.files?.[0];if(a){if(!a.type.startsWith("image/")){alert("请选择图片文件");return}if(a.size>2*1024*1024){alert("图片大小不能超过 2MB");return}V.value=a,r.avatar=a,r.remove_avatar=!1;const $=new FileReader;$.onload=j=>{b.value=j.target?.result},$.readAsDataURL(a)}},D=()=>{confirm("确定要删除头像吗？")&&(b.value=null,V.value=null,r.avatar=null,r.remove_avatar=!0)},F=()=>{r.transform(c=>({...c,_method:"PUT"})).post(`/admin/users/${i.user.id}`,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{}})},U=()=>{B.visit("/admin/users")},y=k(!1),N=()=>{confirm("确定要根据交易记录重新计算用户的积分和金币余额吗？这将覆盖当前余额。")&&(y.value=!0,B.post(`/admin/users/${i.user.id}/consolidate-balances`,{},{preserveScroll:!0,onSuccess:()=>{y.value=!1},onError:()=>{y.value=!1}}))};return(c,s)=>(n(),q(G,null,{default:l(()=>[o(e(z),{title:`编辑用户 - ${c.user.name}`},null,8,["title"]),t("div",K,[t("div",O,[t("div",Q,[t("div",Y,[t("div",Z,[t("div",ee,[o(e(x),{variant:"outline",size:"icon",onClick:U},{default:l(()=>[o(e(W),{class:"h-4 w-4"})]),_:1}),s[12]||(s[12]=t("h1",{class:"text-2xl font-semibold"},"编辑用户",-1))])]),o(e(I),null,{default:l(()=>[o(e(h),null,{default:l(()=>[o(e(J),null,{default:l(()=>s[13]||(s[13]=[d("用户信息",-1)])),_:1,__:[13]}),o(e(T),null,{default:l(()=>s[14]||(s[14]=[d(" 编辑用户的基本信息和权限设置 ",-1)])),_:1,__:[14]})]),_:1}),o(e(L),null,{default:l(()=>[t("form",{onSubmit:E(F,["prevent"]),class:"space-y-6"},[t("div",se,[s[26]||(s[26]=t("h3",{class:"text-lg font-medium"},"基本信息",-1)),t("div",re,[o(e(p),null,{default:l(()=>s[15]||(s[15]=[d("头像",-1)])),_:1,__:[15]}),t("div",te,[t("div",oe,[b.value?(n(),u("div",ae,[t("img",{src:b.value,alt:"Avatar preview",class:"w-full h-full object-cover"},null,8,le)])):(n(),u("div",de,[o(e(M),{class:"h-8 w-8 text-gray-400"})])),b.value?(n(),u("button",{key:2,type:"button",onClick:D,class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600"},[o(e(X),{class:"h-4 w-4"})])):f("",!0)]),t("div",ie,[t("input",{type:"file",id:"avatar",accept:"image/*",onChange:A,class:"hidden"},null,32),t("label",ne,[o(e(M),{class:"h-4 w-4 mr-2"}),s[16]||(s[16]=d(" 选择图片 ",-1))]),s[17]||(s[17]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," 支持 JPG, PNG, GIF 格式，最大 2MB ",-1))])]),e(r).errors.avatar?(n(),u("p",ue,m(e(r).errors.avatar),1)):f("",!0)]),t("div",me,[o(e(p),{for:"name"},{default:l(()=>s[18]||(s[18]=[d("姓名 *",-1)])),_:1,__:[18]}),o(e(g),{id:"name",modelValue:e(r).name,"onUpdate:modelValue":s[0]||(s[0]=a=>e(r).name=a),type:"text",required:"",class:_({"border-red-500":e(r).errors.name})},null,8,["modelValue","class"]),e(r).errors.name?(n(),u("p",pe,m(e(r).errors.name),1)):f("",!0)]),t("div",fe,[o(e(p),{for:"email"},{default:l(()=>s[19]||(s[19]=[d("邮箱 *",-1)])),_:1,__:[19]}),o(e(g),{id:"email",modelValue:e(r).email,"onUpdate:modelValue":s[1]||(s[1]=a=>e(r).email=a),type:"email",required:"",class:_({"border-red-500":e(r).errors.email})},null,8,["modelValue","class"]),e(r).errors.email?(n(),u("p",_e,m(e(r).errors.email),1)):f("",!0)]),t("div",ge,[o(e(p),{for:"login_name"},{default:l(()=>s[20]||(s[20]=[d("用户名 *",-1)])),_:1,__:[20]}),o(e(g),{id:"login_name",modelValue:e(r).login_name,"onUpdate:modelValue":s[2]||(s[2]=a=>e(r).login_name=a),type:"text",required:"",class:_({"border-red-500":e(r).errors.login_name})},null,8,["modelValue","class"]),s[21]||(s[21]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 用于登录的唯一用户名 ",-1)),e(r).errors.login_name?(n(),u("p",ye,m(e(r).errors.login_name),1)):f("",!0)]),t("div",ce,[o(e(p),{for:"password"},{default:l(()=>s[22]||(s[22]=[d("新密码",-1)])),_:1,__:[22]}),o(e(g),{id:"password",modelValue:e(r).password,"onUpdate:modelValue":s[3]||(s[3]=a=>e(r).password=a),type:"password",autocomplete:"new-password",class:_({"border-red-500":e(r).errors.password})},null,8,["modelValue","class"]),s[23]||(s[23]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 留空表示不修改密码 ",-1)),e(r).errors.password?(n(),u("p",be,m(e(r).errors.password),1)):f("",!0)]),t("div",ve,[o(e(p),{for:"password_confirmation"},{default:l(()=>s[24]||(s[24]=[d("确认新密码",-1)])),_:1,__:[24]}),o(e(g),{id:"password_confirmation",modelValue:e(r).password_confirmation,"onUpdate:modelValue":s[4]||(s[4]=a=>e(r).password_confirmation=a),type:"password",autocomplete:"new-password",class:_({"border-red-500":e(r).errors.password_confirmation})},null,8,["modelValue","class"]),s[25]||(s[25]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 请再次输入新密码 ",-1)),e(r).errors.password_confirmation?(n(),u("p",xe,m(e(r).errors.password_confirmation),1)):f("",!0)])]),t("div",ke,[s[33]||(s[33]=t("h3",{class:"text-lg font-medium"},"账户设置",-1)),t("div",we,[o(e(p),{for:"type"},{default:l(()=>s[27]||(s[27]=[d("用户类型",-1)])),_:1,__:[27]}),v(t("select",{id:"type","onUpdate:modelValue":s[5]||(s[5]=a=>e(r).type=a),class:_(["w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":e(r).errors.type}])},s[28]||(s[28]=[t("option",{value:1},"普通用户",-1),t("option",{value:2},"高级用户",-1)]),2),[[C,e(r).type,void 0,{number:!0}]]),e(r).errors.type?(n(),u("p",Ve,m(e(r).errors.type),1)):f("",!0)]),t("div",Ue,[o(e(p),{for:"status"},{default:l(()=>s[29]||(s[29]=[d("账户状态",-1)])),_:1,__:[29]}),v(t("select",{id:"status","onUpdate:modelValue":s[6]||(s[6]=a=>e(r).status=a),class:_(["w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":e(r).errors.status}])},s[30]||(s[30]=[t("option",{value:1},"正常",-1),t("option",{value:2},"暂停",-1),t("option",{value:3},"禁止",-1)]),2),[[C,e(r).status,void 0,{number:!0}]]),e(r).errors.status?(n(),u("p",$e,m(e(r).errors.status),1)):f("",!0)]),t("div",Ce,[o(e(p),{for:"credits"},{default:l(()=>s[31]||(s[31]=[d("金币余额",-1)])),_:1,__:[31]}),o(e(g),{id:"credits",modelValue:e(r).credits,"onUpdate:modelValue":s[7]||(s[7]=a=>e(r).credits=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",class:_({"border-red-500":e(r).errors.credits})},null,8,["modelValue","class"]),e(r).errors.credits?(n(),u("p",Be,m(e(r).errors.credits),1)):f("",!0)]),t("div",Me,[o(e(p),{for:"balance"},{default:l(()=>s[32]||(s[32]=[d("积分余额",-1)])),_:1,__:[32]}),o(e(g),{id:"balance",modelValue:e(r).balance,"onUpdate:modelValue":s[8]||(s[8]=a=>e(r).balance=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",class:_({"border-red-500":e(r).errors.balance})},null,8,["modelValue","class"]),e(r).errors.balance?(n(),u("p",Se,m(e(r).errors.balance),1)):f("",!0)])]),t("div",Ae,[s[37]||(s[37]=t("h3",{class:"text-lg font-medium"},"权限设置",-1)),t("div",De,[v(t("input",{id:"is_creator","onUpdate:modelValue":s[9]||(s[9]=a=>e(r).is_creator=a),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[w,e(r).is_creator]]),o(e(p),{for:"is_creator",class:"cursor-pointer"},{default:l(()=>s[34]||(s[34]=[d(" 创作者权限 ",-1)])),_:1,__:[34]})]),s[38]||(s[38]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 pl-6"}," 可以发布和管理内容 ",-1)),t("div",Fe,[v(t("input",{id:"is_verified","onUpdate:modelValue":s[10]||(s[10]=a=>e(r).is_verified=a),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[w,e(r).is_verified]]),o(e(p),{for:"is_verified",class:"cursor-pointer"},{default:l(()=>s[35]||(s[35]=[d(" 已认证 ",-1)])),_:1,__:[35]})]),s[39]||(s[39]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 pl-6"}," 显示认证标识，表示身份已验证 ",-1)),t("div",Ne,[v(t("input",{id:"is_top_creator","onUpdate:modelValue":s[11]||(s[11]=a=>e(r).is_top_creator=a),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[w,e(r).is_top_creator]]),o(e(p),{for:"is_top_creator",class:"cursor-pointer"},{default:l(()=>s[36]||(s[36]=[d(" 顶级创作者 ",-1)])),_:1,__:[36]})]),s[40]||(s[40]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 pl-6"}," 显示特殊标识，表示优质创作者 ",-1))]),t("div",je,[s[42]||(s[42]=t("h3",{class:"text-sm font-medium mb-2"},"用户信息",-1)),t("div",Pe,[t("p",null,[s[41]||(s[41]=d("用户ID: ",-1)),t("span",Re,m(c.user.id),1)])])]),t("div",qe,[o(e(x),{type:"submit",disabled:e(r).processing},{default:l(()=>[d(m(e(r).processing?"保存中...":"保存更改"),1)]),_:1},8,["disabled"]),o(e(x),{type:"button",variant:"outline",onClick:U},{default:l(()=>s[43]||(s[43]=[d(" 取消 ",-1)])),_:1,__:[43]}),o(e(x),{type:"button",variant:"destructive",onClick:N,disabled:y.value},{default:l(()=>[o(e(H),{class:_([{"animate-spin":y.value},"mr-2 h-4 w-4"])},null,8,["class"]),d(" "+m(y.value?"计算中...":"重新计算余额"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])])])])]),_:1}))}});export{ps as default};
