import{d as H,O as Q,C as F,u as Y,l as g,c as k,o as r,w as a,a as l,b as o,e,h as Z,t as c,f as n,n as M,k as P,i as u,F as j,s as z,q as ee,p as te,j as f,m as se,v as le}from"./app-DRBRIKfK.js";import{_ as oe}from"./WebLayout.vue_vue_type_script_setup_true_lang-CNqXeW8L.js";import{_ as B}from"./index-DgBj-Q9R.js";import{_,a as b}from"./CardContent.vue_vue_type_script_setup_true_lang-I--LfiuB.js";import{_ as x}from"./CardHeader.vue_vue_type_script_setup_true_lang-BPkq3JDW.js";import{_ as v}from"./CardTitle.vue_vue_type_script_setup_true_lang-Cum192sa.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-BsJB2v0k.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-DAvGma_5.js";import{_ as T}from"./index-DXBpUgaR.js";import{_ as y}from"./InputError.vue_vue_type_script_setup_true_lang-B005pDmJ.js";import{v as ae,p as ie,a as re,b as ne,c as de,d as ue,e as ce,I as fe,V as pe,S as me,f as ge}from"./filepond-plugin-image-transform.esm-DL0dFo1h.js";import{F as _e}from"./file-text-DvGDOYxj.js";import{X as I}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-4zeNRpLF.js";import{T as be}from"./tag-BMD_NfQO.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DAvHm5O_.js";import"./createLucideIcon-CQAt1dvW.js";import"./heart-B5znrlXd.js";import"./user-B3ZLz0SV.js";import"./Primitive-7cNkpOX2.js";import"./index-DU1yfhll.js";import"./useForwardExpose-_UyPYnA2.js";import"./usePrimitiveElement-DLgjSv9B.js";import"./RovingFocusGroup-BjoewhWM.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-C5W0E7bH.js";const xe={class:"min-h-screen py-8"},ve={class:"max-w-4xl mx-auto px-4"},ye={class:"mb-8"},we={class:"text-[#999999]"},he={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ke={class:"lg:col-span-2 space-y-6"},Be=["value"],Ve={class:"mt-2"},$e={key:0,class:"mt-2"},Ce={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-[#4B5563] rounded-lg cursor-pointer hover:border-[#ff6e02] transition-colors bg-[#1c1c1c]"},Ue={class:"flex flex-col items-center justify-center pt-5 pb-6"},Fe={key:1,class:"mt-2"},Me={class:"relative bg-[#1c1c1c] rounded-lg overflow-hidden"},Pe=["src"],je={class:"text-xs text-[#999999] mt-1"},ze={class:"flex gap-2 mb-3"},Te={key:0,class:"flex flex-wrap gap-2"},Se=["onClick"],Le={class:"space-y-6"},Ie={class:"flex items-center justify-between"},Re={class:"relative inline-flex items-center cursor-pointer"},Ne={key:0,class:"space-y-4 pt-4 border-t border-[#4B5563]"},Oe={key:0},qe={class:"space-y-2 pt-4 border-t border-[#4B5563]"},De={key:0,class:"flex items-center gap-2"},Ge={class:"text-lg"},We={key:1,class:"text-white font-medium"},Ke={key:2,class:"flex items-center gap-2"},Ee={class:"text-sm text-[#999999]"},Je={key:3,class:"text-sm text-[#999999] line-clamp-3"},Xe={key:4,class:"flex flex-wrap gap-1"},Ae={key:0,class:"text-xs text-[#999999]"},ht=H({__name:"Create",props:{categories:{}},setup(R){const N=ae(ce,ue,de,ne,re,ie),O=R,q=Q(),D=F(()=>q.props.auth?.user?.is_creator||!1),s=Y({title:"",content:"",post_category_id:"",type:"showcase",excerpt:"",images:[],video:null,videos:[],tags:[],is_premium:!1,price:null,free_after:null,status:"draft"}),w=g("");g("");const $=g(null),C=g(null),p=g(null),G=[{value:"discussion",label:"讨论",icon:"💬",description:"分享想法和观点"},{value:"tutorial",label:"教程",icon:"📖",description:"分享知识和技能"},{value:"showcase",label:"展示",icon:"🎨",description:"展示你的作品"},{value:"question",label:"问题",icon:"❓",description:"寻求帮助和建议"}],U=F(()=>O.categories.find(d=>d.id.toString()===s.post_category_id)),h=F(()=>G.find(d=>d.value===s.type));function S(){const d=w.value.trim();d&&!s.tags.includes(d)&&(s.tags.push(d),w.value="")}function W(d){s.tags.splice(d,1)}function K(){if($.value){const d=$.value.getFiles();s.images=d.map(t=>t.file)}}function E(d){const i=d.target.files?.[0];if(i){if(i.size>100*1024*1024){alert("视频文件太大！最大支持100MB");return}if(!i.type.startsWith("video/")){alert("请上传有效的视频文件");return}s.video=i,p.value&&URL.revokeObjectURL(p.value),p.value=URL.createObjectURL(i)}}function J(){s.video=null,p.value&&(URL.revokeObjectURL(p.value),p.value=null),C.value&&(C.value.value="")}function X(){s.status="draft",s.post("/posts",{onSuccess:()=>{}})}function A(){s.status="published",s.post("/posts",{onSuccess:()=>{}})}return(d,t)=>(r(),k(oe,null,{default:a(()=>[l(e(Z),{title:"创建新帖子"}),o("div",xe,[o("div",ve,[o("div",ye,[t[7]||(t[7]=o("h1",{class:"text-3xl font-bold text-white mb-2"},"创建新帖子",-1)),o("p",we,"分享你的想法、经验或问题给"+c(d.$page.props.name),1)]),o("div",he,[o("div",ke,[l(e(_),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[l(e(x),null,{default:a(()=>[l(e(v),{class:"text-white flex items-center gap-2"},{default:a(()=>[l(e(_e),{class:"h-5 w-5"}),t[8]||(t[8]=n(" 基本信息 ",-1))]),_:1,__:[8]})]),_:1}),l(e(b),{class:"space-y-4"},{default:a(()=>[o("div",null,[l(e(m),{for:"title",class:"text-white"},{default:a(()=>t[9]||(t[9]=[n("标题 *",-1)])),_:1,__:[9]}),l(e(V),{id:"title",modelValue:e(s).title,"onUpdate:modelValue":t[0]||(t[0]=i=>e(s).title=i),placeholder:"输入帖子标题...",class:M(["mt-1 bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]",{"border-red-500":e(s).errors.title}])},null,8,["modelValue","class"]),l(y,{message:e(s).errors.title,class:"mt-1"},null,8,["message"])]),o("div",null,[l(e(m),{class:"text-white"},{default:a(()=>t[10]||(t[10]=[n("分类 *",-1)])),_:1,__:[10]}),P(o("select",{"onUpdate:modelValue":t[1]||(t[1]=i=>e(s).post_category_id=i),class:M(["mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02]",{"border-red-500":e(s).errors.post_category_id}])},[t[11]||(t[11]=o("option",{value:"",class:"text-[#999999]"},"选择分类",-1)),(r(!0),u(j,null,z(d.categories,i=>(r(),u("option",{key:i.id,value:i.id.toString(),class:"bg-[#1c1c1c] text-white"},c(i.name),9,Be))),128))],2),[[ee,e(s).post_category_id]]),l(y,{message:e(s).errors.post_category_id,class:"mt-1"},null,8,["message"])]),o("div",null,[l(e(m),{for:"content",class:"text-white"},{default:a(()=>t[12]||(t[12]=[n("内容 *",-1)])),_:1,__:[12]}),P(o("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=i=>e(s).content=i),placeholder:"写下你的内容...",rows:"12",class:M(["mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white placeholder:text-[#999999] rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02] resize-y",{"border-red-500":e(s).errors.content}])},null,2),[[te,e(s).content]]),l(y,{message:e(s).errors.content,class:"mt-1"},null,8,["message"])])]),_:1})]),_:1}),l(e(_),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[l(e(x),null,{default:a(()=>[l(e(v),{class:"text-white flex items-center gap-2"},{default:a(()=>[l(e(fe),{class:"h-5 w-5"}),t[13]||(t[13]=n(" 媒体内容 ",-1))]),_:1,__:[13]})]),_:1}),l(e(b),{class:"space-y-4"},{default:a(()=>[o("div",null,[l(e(m),{class:"text-white"},{default:a(()=>t[14]||(t[14]=[n("图片 (最多4张)",-1)])),_:1,__:[14]}),o("div",Ve,[l(e(N),{ref_key:"pond",ref:$,name:"images","allow-multiple":!0,"max-files":4,"accepted-file-types":"image/jpeg, image/jpg, image/png, image/gif, image/webp","max-file-size":"5MB","label-idle":"拖放图片或 <span class='filepond--label-action'>浏览</span>","label-file-loading":"加载中","label-file-processing":"上传中","label-tap-to-cancel":"点击取消","label-tap-to-retry":"点击重试","label-tap-to-undo":"点击撤销","image-resize-target-width":1200,"image-resize-target-height":900,"image-resize-mode":"contain","image-resize-upscale":"false","image-transform-output-quality":85,"image-transform-output-quality-mode":"always",onUpdatefiles:K,"style-panel-layout":"compact","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom"},null,512)]),t[15]||(t[15]=o("p",{class:"text-xs text-[#999999] mt-2"},"支持 JPG, PNG, GIF, WebP，单张最大5MB。图片将自动优化。",-1)),l(y,{message:e(s).errors.images,class:"mt-1"},null,8,["message"])]),o("div",null,[l(e(m),{class:"text-white"},{default:a(()=>t[16]||(t[16]=[n("视频 (可选)",-1)])),_:1,__:[16]}),p.value?f("",!0):(r(),u("div",$e,[o("label",Ce,[o("div",Ue,[l(e(pe),{class:"w-10 h-10 mb-3 text-[#999999]"}),t[17]||(t[17]=o("p",{class:"mb-2 text-sm text-[#999999]"},[o("span",{class:"font-semibold text-[#ff6e02]"},"点击上传视频")],-1)),t[18]||(t[18]=o("p",{class:"text-xs text-[#999999]"},"支持 MP4, WebM, MOV (最大100MB)",-1))]),o("input",{ref_key:"videoInput",ref:C,type:"file",class:"hidden",accept:"video/*",onChange:E},null,544)])])),p.value?(r(),u("div",Fe,[o("div",Me,[o("video",{src:p.value,controls:"",class:"w-full max-h-64 object-contain"},null,8,Pe),l(e(B),{type:"button",size:"sm",variant:"ghost",onClick:J,class:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white"},{default:a(()=>[l(e(I),{class:"h-4 w-4"})]),_:1})]),o("p",je,c(e(s).video?.name)+" ("+c((e(s).video?.size/1024/1024).toFixed(2))+"MB) ",1)])):f("",!0),l(y,{message:e(s).errors.video,class:"mt-1"},null,8,["message"])])]),_:1})]),_:1}),l(e(_),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[l(e(x),null,{default:a(()=>[l(e(v),{class:"text-white flex items-center gap-2"},{default:a(()=>[l(e(be),{class:"h-5 w-5"}),t[19]||(t[19]=n(" 标签 ",-1))]),_:1,__:[19]})]),_:1}),l(e(b),null,{default:a(()=>[o("div",ze,[l(e(V),{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=i=>w.value=i),placeholder:"输入标签...",class:"bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]",onKeyup:se(S,["enter"])},null,8,["modelValue"]),l(e(B),{type:"button",onClick:S,class:"bg-[#ff6e02] hover:bg-[#e55a00] text-white"},{default:a(()=>t[20]||(t[20]=[n(" 添加 ",-1)])),_:1,__:[20]})]),e(s).tags.length>0?(r(),u("div",Te,[(r(!0),u(j,null,z(e(s).tags,(i,L)=>(r(),k(e(T),{key:L,class:"bg-[#ff6e02]/20 text-[#ff6e02] border-[#ff6e02]/30"},{default:a(()=>[n(c(i)+" ",1),o("button",{type:"button",onClick:He=>W(L),class:"ml-1 hover:text-red-300"},[l(e(I),{class:"h-3 w-3"})],8,Se)]),_:2},1024))),128))])):f("",!0)]),_:1})]),_:1})]),o("div",Le,[l(e(_),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[l(e(x),null,{default:a(()=>[l(e(v),{class:"text-white"},{default:a(()=>t[21]||(t[21]=[n("发布设置",-1)])),_:1,__:[21]})]),_:1}),l(e(b),{class:"space-y-4"},{default:a(()=>[o("div",Ie,[o("div",null,[l(e(m),{class:"text-white"},{default:a(()=>t[22]||(t[22]=[n("高级内容",-1)])),_:1,__:[22]}),t[23]||(t[23]=o("p",{class:"text-xs text-[#999999]"},"仅VIP会员可见",-1))]),o("label",Re,[P(o("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=i=>e(s).is_premium=i),class:"sr-only peer"},null,512),[[le,e(s).is_premium]]),t[24]||(t[24]=o("div",{class:"w-11 h-6 bg-[#4B5563] peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[#ff6e02] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#ff6e02]"},null,-1))])]),D.value?(r(),u("div",Ne,[o("div",null,[l(e(m),{for:"price",class:"text-white flex items-center gap-2"},{default:a(()=>t[25]||(t[25]=[n(" 💰 内容定价 ",-1)])),_:1,__:[25]}),t[26]||(t[26]=o("p",{class:"text-xs text-[#999999] mb-2"},"设置用户需要支付的积分数量才能查看此帖子",-1)),l(e(V),{id:"price",modelValue:e(s).price,"onUpdate:modelValue":t[5]||(t[5]=i=>e(s).price=i),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",placeholder:"0 = 免费",class:"bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]"},null,8,["modelValue"]),t[27]||(t[27]=o("p",{class:"text-xs text-[#999999] mt-1"},"留空或输入0表示免费",-1))]),e(s).price&&e(s).price>0?(r(),u("div",Oe,[l(e(m),{for:"free_after",class:"text-white flex items-center gap-2"},{default:a(()=>t[28]||(t[28]=[n(" ⏰ 免费开放时间 ",-1)])),_:1,__:[28]}),t[29]||(t[29]=o("p",{class:"text-xs text-[#999999] mb-2"},"设置该日期后此内容将自动变为免费",-1)),l(e(V),{id:"free_after",modelValue:e(s).free_after,"onUpdate:modelValue":t[6]||(t[6]=i=>e(s).free_after=i),type:"datetime-local",class:"bg-[#1c1c1c] border-[#4B5563] text-white"},null,8,["modelValue"]),t[30]||(t[30]=o("p",{class:"text-xs text-[#999999] mt-1"},"可选：留空表示永久收费",-1))])):f("",!0)])):f("",!0),o("div",qe,[l(e(B),{type:"button",onClick:X,disabled:e(s).processing,class:"w-full bg-[#4B5563] hover:bg-[#6B7280] text-white"},{default:a(()=>[l(e(me),{class:"h-4 w-4 mr-2"}),n(" "+c(e(s).processing?"保存中...":"保存草稿"),1)]),_:1},8,["disabled"]),l(e(B),{type:"button",onClick:A,disabled:e(s).processing,class:"w-full bg-[#ff6e02] hover:bg-[#e55a00] text-white"},{default:a(()=>[l(e(ge),{class:"h-4 w-4 mr-2"}),n(" "+c(e(s).processing?"发布中...":"立即发布"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),e(s).title||U.value||h.value?(r(),k(e(_),{key:0,class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[l(e(x),null,{default:a(()=>[l(e(v),{class:"text-white"},{default:a(()=>t[31]||(t[31]=[n("预览",-1)])),_:1,__:[31]})]),_:1}),l(e(b),{class:"space-y-3"},{default:a(()=>[h.value?(r(),u("div",De,[o("span",Ge,c(h.value.icon),1),l(e(T),{class:"bg-[#ff6e02]/20 text-[#ff6e02] border-[#ff6e02]/30"},{default:a(()=>[n(c(h.value.label),1)]),_:1})])):f("",!0),e(s).title?(r(),u("h3",We,c(e(s).title),1)):f("",!0),U.value?(r(),u("div",Ke,[t[32]||(t[32]=o("div",{class:"w-3 h-3 rounded-full bg-[#ff6e02]"},null,-1)),o("span",Ee,c(U.value.name),1)])):f("",!0),e(s).excerpt?(r(),u("p",Je,c(e(s).excerpt),1)):f("",!0),e(s).tags.length>0?(r(),u("div",Xe,[(r(!0),u(j,null,z(e(s).tags.slice(0,3),i=>(r(),k(e(T),{key:i,class:"text-xs bg-[#1c1c1c] text-[#999999]"},{default:a(()=>[n(" #"+c(i),1)]),_:2},1024))),128)),e(s).tags.length>3?(r(),u("span",Ae," +"+c(e(s).tags.length-3)+" more ",1)):f("",!0)])):f("",!0)]),_:1})]),_:1})):f("",!0)])])])])]),_:1}))}});export{ht as default};
