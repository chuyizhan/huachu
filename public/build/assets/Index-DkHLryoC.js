import{d as W,r as p,c as K,o as f,w as s,a,b as e,e as o,h as X,y as Y,f as n,t as d,k as g,m as Z,p as w,i as m,F as L,s as j,q as _,n as q,l as z}from"./app-omrOMKVL.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-bjNwbGzX.js";import{_ as M,a as B}from"./CardContent.vue_vue_type_script_setup_true_lang-DI2i9Skb.js";import{_ as F}from"./CardDescription.vue_vue_type_script_setup_true_lang-BRStuxco.js";import{_ as N}from"./CardHeader.vue_vue_type_script_setup_true_lang-L8cfcDYH.js";import{_ as te,a as re,b as E,c as b,d as oe,e as y}from"./TableRow.vue_vue_type_script_setup_true_lang-CW8PP_5o.js";import{_ as se}from"./index-DZLll_k7.js";import{P as ae}from"./plus-DIP3mp15.js";import"./Primitive-CqfJ75Ql.js";import"./useForwardExpose-z2OA6_ay.js";import"./usePrimitiveElement-BnM25tZc.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-DmhzqpeE.js";import"./createLucideIcon-DD0foOWP.js";import"./RovingFocusGroup-DlE2znV6.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-C5W0E7bH.js";import"./VisuallyHidden-y_-ptxJe.js";import"./index-Dbg1u9AM.js";import"./DialogTitle-DpxAaeRA.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-htH7RIcW.js";import"./shield-lZk7-9GN.js";import"./file-text-CZKcEs7-.js";import"./trending-up-8EDjQJTb.js";import"./chevron-right-zHX_yZmE.js";const le={class:"py-12"},de={class:"w-full sm:px-6 lg:px-8"},ne={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800"},ue={class:"p-6 text-gray-900 dark:text-gray-100"},ie={class:"mb-6 flex items-center justify-between"},pe={class:"grid gap-4 md:grid-cols-4 mb-6"},ge={class:"text-2xl font-bold"},fe={class:"text-2xl font-bold text-green-600"},ve={class:"text-2xl font-bold text-blue-600"},be={class:"text-2xl font-bold text-red-600"},ye={class:"mb-6 space-y-4"},ce={class:"flex flex-wrap gap-4"},me={class:"flex-1 min-w-[200px]"},_e={class:"min-w-[200px]"},xe=["value"],ke={class:"min-w-[120px]"},we={class:"min-w-[150px]"},he=["value"],Ce={class:"flex flex-wrap gap-4"},$e={class:"min-w-[120px]"},Ve={class:"min-w-[120px]"},Ue={class:"min-w-[150px]"},Se={class:"min-w-[150px]"},De={class:"min-w-[150px]"},Te={class:"flex flex-wrap gap-4"},Pe={class:"min-w-[150px]"},Ie={class:"min-w-[120px]"},Me={class:"min-w-[120px]"},Be={class:"overflow-x-auto"},Fe={class:"space-y-1"},Ne={class:"font-medium"},Le={class:"text-sm text-gray-500 dark:text-gray-400"},je={key:0,class:"text-sm"},ze={class:"text-gray-500 dark:text-gray-400"},Ae={key:1,class:"text-gray-400"},Ke=["onClick"],qe={class:"mt-6 flex items-center justify-between"},Ee={class:"text-sm text-gray-700 dark:text-gray-300"},Ge={class:"flex gap-2"},He=["disabled"],Je={class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300"},Oe=["disabled"],_t=W({__name:"Index",props:{transactions:{},users:{},reasons:{},stats:{},filters:{}},setup(G){const i=G,h=p(i.filters.search||""),C=p(i.filters.user_id||""),$=p(i.filters.type||""),V=p(i.filters.reason||""),U=p(i.filters.credits_min||""),S=p(i.filters.credits_max||""),D=p(i.filters.date_from||""),T=p(i.filters.date_to||""),P=p(i.filters.related_type||""),c=p(i.filters.sort_by||"created_at"),v=p(i.filters.sort_direction||"desc"),I=p(i.filters.per_page||20),u=()=>{z.get("/admin/credit-transactions",{search:h.value||void 0,user_id:C.value||void 0,type:$.value||void 0,reason:V.value||void 0,credits_min:U.value||void 0,credits_max:S.value||void 0,date_from:D.value||void 0,date_to:T.value||void 0,related_type:P.value||void 0,sort_by:c.value,sort_direction:v.value,per_page:I.value},{preserveState:!0,preserveScroll:!0})},H=()=>{h.value="",C.value="",$.value="",V.value="",U.value="",S.value="",D.value="",T.value="",P.value="",c.value="created_at",v.value="desc",I.value=20,u()},x=l=>{c.value===l?v.value=v.value==="asc"?"desc":"asc":(c.value=l,v.value="asc"),u()},k=l=>c.value!==l?"↕":v.value==="asc"?"↑":"↓",J=l=>new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),A=l=>{z.get("/admin/credit-transactions",{...i.filters,page:l},{preserveState:!0,preserveScroll:!0})},O=l=>{confirm("确定要删除这个金币交易吗？这将回滚用户金币。")&&z.delete(`/admin/credit-transactions/${l}`,{preserveScroll:!0})},Q=l=>({earned:"text-green-800 bg-green-100 dark:bg-green-900 dark:text-green-200",spent:"text-blue-800 bg-blue-100 dark:bg-blue-900 dark:text-blue-200",deducted:"text-red-800 bg-red-100 dark:bg-red-900 dark:text-red-200",refunded:"text-purple-800 bg-purple-100 dark:bg-purple-900 dark:text-purple-200"})[l]||"text-gray-800 bg-gray-100 dark:bg-gray-700 dark:text-gray-200",R=l=>({earned:"获得",spent:"消费",deducted:"扣除",refunded:"退款"})[l]||l;return(l,t)=>(f(),K(ee,null,{default:s(()=>[a(o(X),{title:"金币交易管理"}),e("div",le,[e("div",de,[e("div",ne,[e("div",ue,[e("div",ie,[t[20]||(t[20]=e("h1",{class:"text-2xl font-semibold"},"金币交易管理",-1)),a(o(Y),{href:"/admin/credit-transactions/create"},{default:s(()=>[a(o(se),null,{default:s(()=>[a(o(ae),{class:"mr-2 h-4 w-4"}),t[19]||(t[19]=n(" 创建交易 ",-1))]),_:1,__:[19]})]),_:1})]),e("div",pe,[a(o(M),null,{default:s(()=>[a(o(N),{class:"pb-2"},{default:s(()=>[a(o(F),null,{default:s(()=>t[21]||(t[21]=[n("总交易数",-1)])),_:1,__:[21]})]),_:1}),a(o(B),null,{default:s(()=>[e("div",ge,d(l.stats.total_transactions),1)]),_:1})]),_:1}),a(o(M),null,{default:s(()=>[a(o(N),{class:"pb-2"},{default:s(()=>[a(o(F),null,{default:s(()=>t[22]||(t[22]=[n("总获得",-1)])),_:1,__:[22]})]),_:1}),a(o(B),null,{default:s(()=>[e("div",fe,"+"+d(l.stats.total_earned),1)]),_:1})]),_:1}),a(o(M),null,{default:s(()=>[a(o(N),{class:"pb-2"},{default:s(()=>[a(o(F),null,{default:s(()=>t[23]||(t[23]=[n("总消费",-1)])),_:1,__:[23]})]),_:1}),a(o(B),null,{default:s(()=>[e("div",ve,d(l.stats.total_spent),1)]),_:1})]),_:1}),a(o(M),null,{default:s(()=>[a(o(N),{class:"pb-2"},{default:s(()=>[a(o(F),null,{default:s(()=>t[24]||(t[24]=[n("总扣除",-1)])),_:1,__:[24]})]),_:1}),a(o(B),null,{default:s(()=>[e("div",be,d(l.stats.total_deducted),1)]),_:1})]),_:1})]),e("div",ye,[e("div",ce,[e("div",me,[g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>h.value=r),type:"text",placeholder:"搜索原因、用户名、邮箱...",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:Z(u,["enter"])},null,544),[[w,h.value]])]),e("div",_e,[g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>C.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},[t[25]||(t[25]=e("option",{value:""},"全部用户",-1)),(f(!0),m(L,null,j(l.users,r=>(f(),m("option",{key:r.id,value:r.id},d(r.name)+" (@"+d(r.login_name)+") ",9,xe))),128))],544),[[_,C.value]])]),e("div",ke,[g(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>$.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},t[26]||(t[26]=[e("option",{value:""},"全部类型",-1),e("option",{value:"earned"},"获得",-1),e("option",{value:"spent"},"消费",-1),e("option",{value:"deducted"},"扣除",-1)]),544),[[_,$.value]])]),e("div",we,[g(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>V.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},[t[27]||(t[27]=e("option",{value:""},"全部原因",-1)),(f(!0),m(L,null,j(l.reasons,r=>(f(),m("option",{key:r,value:r},d(r),9,he))),128))],544),[[_,V.value]])])]),e("div",Ce,[e("div",$e,[g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>U.value=r),type:"number",placeholder:"最小金币",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},null,544),[[w,U.value]])]),e("div",Ve,[g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>S.value=r),type:"number",placeholder:"最大金币",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},null,544),[[w,S.value]])]),e("div",Ue,[g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=r=>D.value=r),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},null,544),[[w,D.value]])]),e("div",Se,[g(e("input",{"onUpdate:modelValue":t[7]||(t[7]=r=>T.value=r),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},null,544),[[w,T.value]])]),e("div",De,[g(e("select",{"onUpdate:modelValue":t[8]||(t[8]=r=>P.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},t[28]||(t[28]=[e("option",{value:""},"全部关联",-1),e("option",{value:"App\\Models\\Post"},"帖子",-1),e("option",{value:"App\\Models\\PostPurchase"},"购买",-1)]),544),[[_,P.value]])])]),e("div",Te,[e("div",Pe,[g(e("select",{"onUpdate:modelValue":t[9]||(t[9]=r=>c.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},t[29]||(t[29]=[e("option",{value:"id"},"ID",-1),e("option",{value:"user_id"},"用户",-1),e("option",{value:"type"},"类型",-1),e("option",{value:"credits"},"金币",-1),e("option",{value:"created_at"},"创建时间",-1)]),544),[[_,c.value]])]),e("div",Ie,[g(e("select",{"onUpdate:modelValue":t[10]||(t[10]=r=>v.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},t[30]||(t[30]=[e("option",{value:"asc"},"升序",-1),e("option",{value:"desc"},"降序",-1)]),544),[[_,v.value]])]),e("div",Me,[g(e("select",{"onUpdate:modelValue":t[11]||(t[11]=r=>I.value=r),class:"w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:u},t[31]||(t[31]=[e("option",{value:10},"10 / 页",-1),e("option",{value:20},"20 / 页",-1),e("option",{value:50},"50 / 页",-1),e("option",{value:100},"100 / 页",-1),e("option",{value:200},"200 / 页",-1)]),544),[[_,I.value]])])]),e("div",{class:"flex gap-2"},[e("button",{type:"button",class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:u}," 搜索 "),e("button",{type:"button",class:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",onClick:H}," 重置 ")])]),e("div",Be,[a(o(te),null,{default:s(()=>[a(o(re),null,{default:s(()=>[a(o(E),null,{default:s(()=>[a(o(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[12]||(t[12]=r=>x("id"))},{default:s(()=>[n(" ID "+d(k("id")),1)]),_:1}),a(o(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[13]||(t[13]=r=>x("user_id"))},{default:s(()=>[n(" 用户 "+d(k("user_id")),1)]),_:1}),a(o(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[14]||(t[14]=r=>x("type"))},{default:s(()=>[n(" 类型 "+d(k("type")),1)]),_:1}),a(o(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[15]||(t[15]=r=>x("credits"))},{default:s(()=>[n(" 金币 "+d(k("credits")),1)]),_:1}),a(o(b),null,{default:s(()=>t[32]||(t[32]=[n("原因",-1)])),_:1,__:[32]}),a(o(b),null,{default:s(()=>t[33]||(t[33]=[n("关联",-1)])),_:1,__:[33]}),a(o(b),{class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:t[16]||(t[16]=r=>x("created_at"))},{default:s(()=>[n(" 创建时间 "+d(k("created_at")),1)]),_:1}),a(o(b),null,{default:s(()=>t[34]||(t[34]=[n("操作",-1)])),_:1,__:[34]})]),_:1})]),_:1}),a(o(oe),null,{default:s(()=>[(f(!0),m(L,null,j(l.transactions.data,r=>(f(),K(o(E),{key:r.id},{default:s(()=>[a(o(y),{class:"font-medium"},{default:s(()=>[n(d(r.id),1)]),_:2},1024),a(o(y),null,{default:s(()=>[e("div",Fe,[e("div",Ne,d(r.user.name),1),e("div",Le," @"+d(r.user.login_name),1)])]),_:2},1024),a(o(y),null,{default:s(()=>[e("span",{class:q(["px-2 py-1 text-xs font-semibold rounded-full",Q(r.type)])},d(R(r.type)),3)]),_:2},1024),a(o(y),null,{default:s(()=>[e("span",{class:q(["font-semibold",{"text-green-600":r.credits>0,"text-red-600":r.credits<0}])},d(r.credits>0?"+":"")+d(r.credits),3)]),_:2},1024),a(o(y),null,{default:s(()=>[n(d(r.reason),1)]),_:2},1024),a(o(y),null,{default:s(()=>[r.related_type?(f(),m("div",je,[e("div",ze,d(r.related_type.split("\\").pop()),1),e("div",null,"ID: "+d(r.related_id),1)])):(f(),m("span",Ae,"-"))]),_:2},1024),a(o(y),{class:"text-sm text-gray-500 dark:text-gray-400"},{default:s(()=>[n(d(J(r.created_at)),1)]),_:2},1024),a(o(y),null,{default:s(()=>[e("button",{type:"button",class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",onClick:Qe=>O(r.id)}," 删除 ",8,Ke)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),e("div",qe,[e("div",Ee," 显示 "+d(l.transactions.data.length)+" 条，共 "+d(l.transactions.total)+" 条 ",1),e("div",Ge,[e("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700",disabled:l.transactions.current_page===1,onClick:t[17]||(t[17]=r=>A(l.transactions.current_page-1))}," 上一页 ",8,He),e("span",Je," 第 "+d(l.transactions.current_page)+" / "+d(l.transactions.last_page)+" 页 ",1),e("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700",disabled:l.transactions.current_page===l.transactions.last_page,onClick:t[18]||(t[18]=r=>A(l.transactions.current_page+1))}," 下一页 ",8,Oe)])])])])])])]),_:1}))}});export{_t as default};
