import{d as te,L as se,C as I,u as le,l as v,c as M,o as a,w as i,a as o,b as s,e,h as oe,i as n,j as f,F as b,s as h,t as c,f as u,n as j,k,q as re,p as O,M as ie,m as ae,v as ne}from"./app-Ca0afq3n.js";import{_ as de}from"./WebLayout.vue_vue_type_script_setup_true_lang-D-woEnGy.js";import{_ as y}from"./index-G1C2CR8F.js";import{_ as B,a as V}from"./CardContent.vue_vue_type_script_setup_true_lang-CgsRRZyd.js";import{_ as C}from"./CardHeader.vue_vue_type_script_setup_true_lang-4fONgwlj.js";import{_ as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-Ba9ncbbw.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-C8Zmhzql.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-N9_9sBsz.js";import{_ as R}from"./index-3Q5PlVJg.js";import{_ as w}from"./InputError.vue_vue_type_script_setup_true_lang-C3SrCxy1.js";import{v as ue,p as ce,a as pe,b as fe,c as me,d as ge,e as ve,I as xe,V as _e,S as be,f as he}from"./filepond-plugin-image-transform.esm-DVRA8B0a.js";import{F as ye}from"./file-text-93NE-onm.js";import{X as S}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-DK07fgD3.js";import{T as we}from"./tag-Ca6N-1Tf.js";import"./createLucideIcon-DPfk0LRx.js";import"./Primitive-CCTnzWDl.js";import"./useForwardExpose-DohNH0gZ.js";import"./usePrimitiveElement-B7nxCNRu.js";import"./RovingFocusGroup-CGclM9bG.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-dW9Vi417.js";const ke={class:"min-h-screen py-8"},Be={class:"max-w-4xl mx-auto px-4"},Ve={key:0,class:"mb-6 bg-red-900/20 border border-red-500 rounded-lg p-4"},Ce={class:"list-disc list-inside text-red-300 text-sm space-y-1"},$e={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Ue={class:"lg:col-span-2 space-y-6"},Fe=["value"],ze={class:"mt-2 grid grid-cols-2 gap-2"},Me=["onClick"],je={class:"flex items-center gap-2"},Pe={class:"text-lg"},Se={class:"font-medium"},Te={class:"text-xs opacity-75"},Le={key:0,class:"mt-2 mb-4"},Ee={class:"grid grid-cols-2 gap-3"},Ie=["src"],Re={class:"mt-2"},De={key:0,class:"mt-2 mb-4"},Ne={class:"relative bg-[#1c1c1c] rounded-lg overflow-hidden"},Oe=["src"],qe={class:"text-xs text-[#999999] mt-1"},Ge={key:1,class:"mt-2"},We={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-[#4B5563] rounded-lg cursor-pointer hover:border-[#ff6e02] transition-colors bg-[#1c1c1c]"},Xe={class:"flex flex-col items-center justify-center pt-5 pb-6"},Ke={key:2,class:"mt-2"},Je={class:"relative bg-[#1c1c1c] rounded-lg overflow-hidden"},Ae=["src"],He={class:"text-xs text-[#999999] mt-1"},Qe={class:"flex gap-2 mb-3"},Ye={key:0,class:"flex flex-wrap gap-2"},Ze=["onClick"],et={class:"space-y-6"},tt={class:"flex items-center justify-between"},st={class:"relative inline-flex items-center cursor-pointer"},lt={key:0,class:"space-y-4 pt-4 border-t border-[#4B5563]"},ot={key:0},rt={class:"space-y-2 pt-4 border-t border-[#4B5563]"},it={key:0,class:"flex items-center gap-2"},at={class:"text-lg"},nt={key:1,class:"text-white font-medium"},dt={key:2,class:"flex items-center gap-2"},ut={class:"text-sm text-[#999999]"},ct={key:3,class:"text-sm text-[#999999] line-clamp-3"},pt={key:4,class:"flex flex-wrap gap-1"},ft={key:0,class:"text-xs text-[#999999]"},Lt=te({__name:"Edit",props:{categories:{},post:{}},setup(q){const G=ue(ve,ge,me,fe,pe,ce),p=q,W=se(),X=I(()=>W.props.auth?.user?.is_creator||!1),l=le({_method:"PUT",title:p.post.title,content:p.post.content,post_category_id:p.post.post_category_id,type:p.post.type,excerpt:p.post.excerpt||"",images:[],remove_images:[],video:null,remove_video:!1,videos:p.post.videos||[],tags:p.post.tags||[],is_premium:p.post.is_premium,price:p.post.price,free_after:p.post.free_after,status:p.post.status}),U=v("");v("");const T=v(null),L=v(null),m=v(null),F=v(p.post.existing_images||[]),x=v(p.post.existing_videos?.[0]||null),D=[{value:"discussion",label:"讨论",icon:"💬",description:"分享想法和观点"},{value:"tutorial",label:"教程",icon:"📖",description:"分享知识和技能"},{value:"showcase",label:"展示",icon:"🎨",description:"展示你的作品"},{value:"question",label:"问题",icon:"❓",description:"寻求帮助和建议"}],E=I(()=>p.categories.find(d=>d.id.toString()===l.post_category_id)),z=I(()=>D.find(d=>d.value===l.type));function N(){const d=U.value.trim();d&&!l.tags.includes(d)&&(l.tags.push(d),U.value="")}function K(d){l.tags.splice(d,1)}function J(){if(T.value){const d=T.value.getFiles();l.images=d.map(t=>t.file)}}function A(d){const r=d.target.files?.[0];if(r){if(r.size>100*1024*1024){alert("视频文件太大！最大支持100MB");return}if(!r.type.startsWith("video/")){alert("请上传有效的视频文件");return}l.video=r,m.value&&URL.revokeObjectURL(m.value),m.value=URL.createObjectURL(r)}}function H(){l.video=null,m.value&&(URL.revokeObjectURL(m.value),m.value=null),L.value&&(L.value.value="")}function Q(d){confirm("确定要删除这张图片吗？")&&(l.remove_images.push(d),F.value=F.value.filter(t=>t.id!==d))}function Y(){confirm("确定要删除这个视频吗？")&&(l.remove_video=!0,x.value=null)}function Z(){l.status="draft",l.post(`/posts/${p.post.id}`,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{},onError:d=>{console.error("Validation errors:",d)}})}function ee(){l.status="published",l.post(`/posts/${p.post.id}`,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{},onError:d=>{console.error("Validation errors:",d)}})}return(d,t)=>(a(),M(de,null,{default:i(()=>[o(e(oe),{title:"编辑帖子"}),s("div",ke,[s("div",Be,[t[39]||(t[39]=s("div",{class:"mb-8"},[s("h1",{class:"text-3xl font-bold text-white mb-2"},"编辑帖子"),s("p",{class:"text-[#999999]"},"更新你的帖子内容")],-1)),Object.keys(e(l).errors).length>0?(a(),n("div",Ve,[t[8]||(t[8]=s("h3",{class:"text-red-400 font-semibold mb-2"},"请修正以下错误:",-1)),s("ul",Ce,[(a(!0),n(b,null,h(e(l).errors,(r,_)=>(a(),n("li",{key:_},c(r),1))),128))])])):f("",!0),s("div",$e,[s("div",Ue,[o(e(B),{class:"bg-[#374151] border-[#4B5563]"},{default:i(()=>[o(e(C),null,{default:i(()=>[o(e($),{class:"text-white flex items-center gap-2"},{default:i(()=>[o(e(ye),{class:"h-5 w-5"}),t[9]||(t[9]=u(" 基本信息 ",-1))]),_:1,__:[9]})]),_:1}),o(e(V),{class:"space-y-4"},{default:i(()=>[s("div",null,[o(e(g),{for:"title",class:"text-white"},{default:i(()=>t[10]||(t[10]=[u("标题 *",-1)])),_:1,__:[10]}),o(e(P),{id:"title",modelValue:e(l).title,"onUpdate:modelValue":t[0]||(t[0]=r=>e(l).title=r),placeholder:"输入帖子标题...",class:j(["mt-1 bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]",{"border-red-500":e(l).errors.title}])},null,8,["modelValue","class"]),o(w,{message:e(l).errors.title,class:"mt-1"},null,8,["message"])]),s("div",null,[o(e(g),{class:"text-white"},{default:i(()=>t[11]||(t[11]=[u("分类 *",-1)])),_:1,__:[11]}),k(s("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>e(l).post_category_id=r),class:j(["mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02]",{"border-red-500":e(l).errors.post_category_id}])},[t[12]||(t[12]=s("option",{value:null,class:"text-[#999999]"},"选择分类",-1)),(a(!0),n(b,null,h(d.categories,r=>(a(),n("option",{key:r.id,value:r.id,class:"bg-[#1c1c1c] text-white"},c(r.name),9,Fe))),128))],2),[[re,e(l).post_category_id,void 0,{number:!0}]]),o(w,{message:e(l).errors.post_category_id,class:"mt-1"},null,8,["message"])]),s("div",null,[o(e(g),{class:"text-white"},{default:i(()=>t[13]||(t[13]=[u("帖子类型 *",-1)])),_:1,__:[13]}),s("div",ze,[(a(),n(b,null,h(D,r=>s("button",{key:r.value,type:"button",onClick:_=>e(l).type=r.value,class:j(["p-3 rounded-lg border text-left transition-colors",e(l).type===r.value?"border-[#ff6e02] bg-[#ff6e02]/10 text-[#ff6e02]":"border-[#4B5563] bg-[#1c1c1c] text-white hover:border-[#6B7280]"])},[s("div",je,[s("span",Pe,c(r.icon),1),s("div",null,[s("div",Se,c(r.label),1),s("div",Te,c(r.description),1)])])],10,Me)),64))]),o(w,{message:e(l).errors.type,class:"mt-1"},null,8,["message"])]),s("div",null,[o(e(g),{for:"content",class:"text-white"},{default:i(()=>t[14]||(t[14]=[u("内容 *",-1)])),_:1,__:[14]}),k(s("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=r=>e(l).content=r),placeholder:"写下你的内容...",rows:"12",class:j(["mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white placeholder:text-[#999999] rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02] resize-y",{"border-red-500":e(l).errors.content}])},null,2),[[O,e(l).content]]),o(w,{message:e(l).errors.content,class:"mt-1"},null,8,["message"])]),s("div",null,[o(e(g),{for:"excerpt",class:"text-white"},{default:i(()=>t[15]||(t[15]=[u("摘要",-1)])),_:1,__:[15]}),k(s("textarea",{id:"excerpt","onUpdate:modelValue":t[3]||(t[3]=r=>e(l).excerpt=r),placeholder:"简短描述你的帖子内容... (可选)",rows:"3",class:"mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white placeholder:text-[#999999] rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02] resize-y"},null,512),[[O,e(l).excerpt]]),t[16]||(t[16]=s("p",{class:"text-xs text-[#999999] mt-1"},"用于搜索结果和社交分享的预览",-1))])]),_:1})]),_:1}),o(e(B),{class:"bg-[#374151] border-[#4B5563]"},{default:i(()=>[o(e(C),null,{default:i(()=>[o(e($),{class:"text-white flex items-center gap-2"},{default:i(()=>[o(e(xe),{class:"h-5 w-5"}),t[17]||(t[17]=u(" 媒体内容 ",-1))]),_:1,__:[17]})]),_:1}),o(e(V),{class:"space-y-4"},{default:i(()=>[s("div",null,[o(e(g),{class:"text-white"},{default:i(()=>t[18]||(t[18]=[u("图片 (最多4张)",-1)])),_:1,__:[18]}),F.value.length>0?(a(),n("div",Le,[s("div",Ee,[(a(!0),n(b,null,h(F.value,r=>(a(),n("div",{key:r.id,class:"relative group rounded-lg overflow-hidden border border-[#4B5563]"},[s("img",{src:r.medium,alt:"Existing image",class:"w-full h-32 object-cover"},null,8,Ie),o(e(y),{type:"button",size:"sm",variant:"ghost",onClick:_=>Q(r.id),class:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white opacity-0 group-hover:opacity-100 transition-opacity"},{default:i(()=>[o(e(S),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]))),128))]),t[19]||(t[19]=s("p",{class:"text-xs text-[#999999] mt-2"},"现有图片 (点击图片上的 X 删除)",-1))])):f("",!0),s("div",Re,[o(e(G),{ref_key:"pond",ref:T,name:"images","allow-multiple":!0,"max-files":4,"accepted-file-types":"image/jpeg, image/jpg, image/png, image/gif, image/webp","max-file-size":"5MB","label-idle":"拖放图片或 <span class='filepond--label-action'>浏览</span>","label-file-loading":"加载中","label-file-processing":"上传中","label-tap-to-cancel":"点击取消","label-tap-to-retry":"点击重试","label-tap-to-undo":"点击撤销","image-resize-target-width":1200,"image-resize-target-height":900,"image-resize-mode":"contain","image-resize-upscale":"false","image-transform-output-quality":85,"image-transform-output-quality-mode":"always",onUpdatefiles:J,"style-panel-layout":"compact","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom"},null,512)]),t[20]||(t[20]=s("p",{class:"text-xs text-[#999999] mt-2"},"支持 JPG, PNG, GIF, WebP，单张最大5MB。图片将自动优化。",-1)),o(w,{message:e(l).errors.images,class:"mt-1"},null,8,["message"])]),s("div",null,[o(e(g),{class:"text-white"},{default:i(()=>t[21]||(t[21]=[u("视频 (可选)",-1)])),_:1,__:[21]}),x.value&&!m.value&&!e(l).remove_video?(a(),n("div",De,[s("div",Ne,[s("video",{src:x.value.url,controls:"",class:"w-full max-h-64 object-contain"},null,8,Oe),o(e(y),{type:"button",size:"sm",variant:"ghost",onClick:Y,class:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white"},{default:i(()=>[o(e(S),{class:"h-4 w-4"})]),_:1})]),s("p",qe,c(x.value.name)+" ("+c((x.value.size/1024/1024).toFixed(2))+"MB) ",1),t[22]||(t[22]=s("p",{class:"text-xs text-[#999999]"},"现有视频 (点击 X 删除并上传新视频)",-1))])):f("",!0),!x.value||e(l).remove_video?k((a(),n("div",Ge,[s("label",We,[s("div",Xe,[o(e(_e),{class:"w-10 h-10 mb-3 text-[#999999]"}),t[23]||(t[23]=s("p",{class:"mb-2 text-sm text-[#999999]"},[s("span",{class:"font-semibold text-[#ff6e02]"},"点击上传视频")],-1)),t[24]||(t[24]=s("p",{class:"text-xs text-[#999999]"},"支持 MP4, WebM, MOV (最大100MB)",-1))]),s("input",{ref_key:"videoInput",ref:L,type:"file",class:"hidden",accept:"video/*",onChange:A},null,544)])],512)),[[ie,!m.value]]):f("",!0),m.value?(a(),n("div",Ke,[s("div",Je,[s("video",{src:m.value,controls:"",class:"w-full max-h-64 object-contain"},null,8,Ae),o(e(y),{type:"button",size:"sm",variant:"ghost",onClick:H,class:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white"},{default:i(()=>[o(e(S),{class:"h-4 w-4"})]),_:1})]),s("p",He,c(e(l).video?.name)+" ("+c((e(l).video?.size/1024/1024).toFixed(2))+"MB) ",1)])):f("",!0),o(w,{message:e(l).errors.video,class:"mt-1"},null,8,["message"])])]),_:1})]),_:1}),o(e(B),{class:"bg-[#374151] border-[#4B5563]"},{default:i(()=>[o(e(C),null,{default:i(()=>[o(e($),{class:"text-white flex items-center gap-2"},{default:i(()=>[o(e(we),{class:"h-5 w-5"}),t[25]||(t[25]=u(" 标签 ",-1))]),_:1,__:[25]})]),_:1}),o(e(V),null,{default:i(()=>[s("div",Qe,[o(e(P),{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=r=>U.value=r),placeholder:"输入标签...",class:"bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]",onKeyup:ae(N,["enter"])},null,8,["modelValue"]),o(e(y),{type:"button",onClick:N,class:"bg-[#ff6e02] hover:bg-[#e55a00] text-white"},{default:i(()=>t[26]||(t[26]=[u(" 添加 ",-1)])),_:1,__:[26]})]),e(l).tags.length>0?(a(),n("div",Ye,[(a(!0),n(b,null,h(e(l).tags,(r,_)=>(a(),M(e(R),{key:_,class:"bg-[#ff6e02]/20 text-[#ff6e02] border-[#ff6e02]/30"},{default:i(()=>[u(c(r)+" ",1),s("button",{type:"button",onClick:mt=>K(_),class:"ml-1 hover:text-red-300"},[o(e(S),{class:"h-3 w-3"})],8,Ze)]),_:2},1024))),128))])):f("",!0)]),_:1})]),_:1})]),s("div",et,[o(e(B),{class:"bg-[#374151] border-[#4B5563]"},{default:i(()=>[o(e(C),null,{default:i(()=>[o(e($),{class:"text-white"},{default:i(()=>t[27]||(t[27]=[u("发布设置",-1)])),_:1,__:[27]})]),_:1}),o(e(V),{class:"space-y-4"},{default:i(()=>[s("div",tt,[s("div",null,[o(e(g),{class:"text-white"},{default:i(()=>t[28]||(t[28]=[u("高级内容",-1)])),_:1,__:[28]}),t[29]||(t[29]=s("p",{class:"text-xs text-[#999999]"},"仅VIP会员可见",-1))]),s("label",st,[k(s("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=r=>e(l).is_premium=r),class:"sr-only peer"},null,512),[[ne,e(l).is_premium]]),t[30]||(t[30]=s("div",{class:"w-11 h-6 bg-[#4B5563] peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[#ff6e02] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#ff6e02]"},null,-1))])]),X.value?(a(),n("div",lt,[s("div",null,[o(e(g),{for:"price",class:"text-white flex items-center gap-2"},{default:i(()=>t[31]||(t[31]=[u(" 💰 内容定价 ",-1)])),_:1,__:[31]}),t[32]||(t[32]=s("p",{class:"text-xs text-[#999999] mb-2"},"设置用户需要支付的积分数量才能查看此帖子",-1)),o(e(P),{id:"price",modelValue:e(l).price,"onUpdate:modelValue":t[6]||(t[6]=r=>e(l).price=r),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",placeholder:"0 = 免费",class:"bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]"},null,8,["modelValue"]),t[33]||(t[33]=s("p",{class:"text-xs text-[#999999] mt-1"},"留空或输入0表示免费",-1))]),e(l).price&&e(l).price>0?(a(),n("div",ot,[o(e(g),{for:"free_after",class:"text-white flex items-center gap-2"},{default:i(()=>t[34]||(t[34]=[u(" ⏰ 免费开放时间 ",-1)])),_:1,__:[34]}),t[35]||(t[35]=s("p",{class:"text-xs text-[#999999] mb-2"},"设置该日期后此内容将自动变为免费",-1)),o(e(P),{id:"free_after",modelValue:e(l).free_after,"onUpdate:modelValue":t[7]||(t[7]=r=>e(l).free_after=r),type:"datetime-local",class:"bg-[#1c1c1c] border-[#4B5563] text-white"},null,8,["modelValue"]),t[36]||(t[36]=s("p",{class:"text-xs text-[#999999] mt-1"},"可选：留空表示永久收费",-1))])):f("",!0)])):f("",!0),s("div",rt,[o(e(y),{type:"button",onClick:Z,disabled:e(l).processing,class:"w-full bg-[#4B5563] hover:bg-[#6B7280] text-white"},{default:i(()=>[o(e(be),{class:"h-4 w-4 mr-2"}),u(" "+c(e(l).processing?"保存中...":"保存草稿"),1)]),_:1},8,["disabled"]),o(e(y),{type:"button",onClick:ee,disabled:e(l).processing,class:"w-full bg-[#ff6e02] hover:bg-[#e55a00] text-white"},{default:i(()=>[o(e(he),{class:"h-4 w-4 mr-2"}),u(" "+c(e(l).processing?"发布中...":"立即发布"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),e(l).title||E.value||z.value?(a(),M(e(B),{key:0,class:"bg-[#374151] border-[#4B5563]"},{default:i(()=>[o(e(C),null,{default:i(()=>[o(e($),{class:"text-white"},{default:i(()=>t[37]||(t[37]=[u("预览",-1)])),_:1,__:[37]})]),_:1}),o(e(V),{class:"space-y-3"},{default:i(()=>[z.value?(a(),n("div",it,[s("span",at,c(z.value.icon),1),o(e(R),{class:"bg-[#ff6e02]/20 text-[#ff6e02] border-[#ff6e02]/30"},{default:i(()=>[u(c(z.value.label),1)]),_:1})])):f("",!0),e(l).title?(a(),n("h3",nt,c(e(l).title),1)):f("",!0),E.value?(a(),n("div",dt,[t[38]||(t[38]=s("div",{class:"w-3 h-3 rounded-full bg-[#ff6e02]"},null,-1)),s("span",ut,c(E.value.name),1)])):f("",!0),e(l).excerpt?(a(),n("p",ct,c(e(l).excerpt),1)):f("",!0),e(l).tags.length>0?(a(),n("div",pt,[(a(!0),n(b,null,h(e(l).tags.slice(0,3),r=>(a(),M(e(R),{key:r,class:"text-xs bg-[#1c1c1c] text-[#999999]"},{default:i(()=>[u(" #"+c(r),1)]),_:2},1024))),128)),e(l).tags.length>3?(a(),n("span",ft," +"+c(e(l).tags.length-3)+" more ",1)):f("",!0)])):f("",!0)]),_:1})]),_:1})):f("",!0)])])])])]),_:1}))}});export{Lt as default};
