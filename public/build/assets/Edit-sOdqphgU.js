import{d as j,r as k,u as I,c as P,o as n,w as l,a as o,b as t,e,h as R,f as d,g as q,i as u,j as f,t as m,n as _,k as v,s as C,v as w,l as B}from"./app-BssXCD8P.js";import{_ as z}from"./AppLayout.vue_vue_type_script_setup_true_lang-HcyzIy4F.js";import{_ as x}from"./index-Dd7j7RKK.js";import{_ as g}from"./Input.vue_vue_type_script_setup_true_lang-DLYP1Tiw.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-Cixkw-zd.js";import{_ as E,a as G}from"./CardContent.vue_vue_type_script_setup_true_lang-D2vOceDs.js";import{_ as L}from"./CardDescription.vue_vue_type_script_setup_true_lang-CfqLy4A5.js";import{_ as T}from"./CardHeader.vue_vue_type_script_setup_true_lang-i5vOpX-7.js";import{_ as H}from"./CardTitle.vue_vue_type_script_setup_true_lang-CQZkTZNl.js";import{A as J}from"./arrow-left-BnxITAsM.js";import{c as W}from"./createLucideIcon-BYHGfaWE.js";import{X}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-BDY1Jps8.js";import{R as K}from"./refresh-cw-vbKQXDth.js";import"./Primitive-DTBK_6IG.js";import"./useForwardExpose-B2twT0nB.js";import"./usePrimitiveElement-Bd27ws6n.js";import"./RovingFocusGroup-DV84Cw1Z.js";import"./VisuallyHidden-Dq_7ZuES.js";import"./index-DIhbgzdr.js";import"./DialogTitle-BPMW-Csx.js";import"./index-hb5zdG9_.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BL-DwtRI.js";import"./shield-yxZ4sI0c.js";import"./trending-up-DF3-4XwL.js";import"./file-text-CbnOED7J.js";import"./chevron-right-BYAd8prG.js";import"./useArrowNavigation-C6Y-ieo6.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=W("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),O={class:"py-12"},Q={class:"w-full sm:px-6 lg:px-8"},Y={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800"},Z={class:"p-6 text-gray-900 dark:text-gray-100"},ee={class:"mb-6 flex items-center justify-between"},se={class:"flex items-center gap-4"},re={class:"space-y-4"},te={class:"space-y-2"},oe={class:"flex items-start gap-4"},ae={class:"relative"},le={key:0,class:"w-24 h-24 rounded-full overflow-hidden border-2 border-gray-300 dark:border-gray-600"},de=["src"],ie={key:1,class:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-2 border-gray-300 dark:border-gray-600"},ne={class:"flex-1"},ue={for:"avatar",class:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer"},me={key:0,class:"text-sm text-red-500"},pe={class:"space-y-2"},fe={key:0,class:"text-sm text-red-500"},_e={class:"space-y-2"},ge={key:0,class:"text-sm text-red-500"},ye={class:"space-y-2"},ce={key:0,class:"text-sm text-red-500"},be={class:"space-y-2"},ve={key:0,class:"text-sm text-red-500"},xe={class:"space-y-2"},ke={key:0,class:"text-sm text-red-500"},we={class:"space-y-4 pt-6 border-t"},Ve={class:"space-y-2"},Ue={key:0,class:"text-sm text-red-500"},$e={class:"space-y-2"},Ce={key:0,class:"text-sm text-red-500"},Be={class:"space-y-2"},Me={key:0,class:"text-sm text-red-500"},Se={class:"space-y-2"},Ae={key:0,class:"text-sm text-red-500"},De={class:"space-y-4 pt-6 border-t"},Fe={class:"flex items-center space-x-2"},Ne={class:"flex items-center space-x-2"},he={class:"flex items-center space-x-2"},je={class:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg"},Ie={class:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},Pe={class:"font-semibold"},Re={class:"flex gap-4"},ps=j({__name:"Edit",props:{user:{}},setup(S){const i=S,b=k(i.user.avatar?`/storage/${i.user.avatar}`:null),V=k(null),r=I({name:i.user.name,email:i.user.email,login_name:i.user.login_name,password:"",password_confirmation:"",is_creator:i.user.is_creator,is_verified:i.user.is_verified,is_top_creator:i.user.is_top_creator,type:i.user.type,status:i.user.status,credits:i.user.credits,balance:i.user.balance,avatar:null,remove_avatar:!1}),A=c=>{const a=c.target.files?.[0];if(a){if(!a.type.startsWith("image/")){alert("请选择图片文件");return}if(a.size>2*1024*1024){alert("图片大小不能超过 2MB");return}V.value=a,r.avatar=a,r.remove_avatar=!1;const $=new FileReader;$.onload=h=>{b.value=h.target?.result},$.readAsDataURL(a)}},D=()=>{confirm("确定要删除头像吗？")&&(b.value=null,V.value=null,r.avatar=null,r.remove_avatar=!0)},F=()=>{r.transform(c=>({...c,_method:"PUT"})).post(`/admin/users/${i.user.id}`,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{}})},U=()=>{B.visit("/admin/users")},y=k(!1),N=()=>{confirm("确定要根据交易记录重新计算用户的积分和金币余额吗？这将覆盖当前余额。")&&(y.value=!0,B.post(`/admin/users/${i.user.id}/consolidate-balances`,{},{preserveScroll:!0,onSuccess:()=>{y.value=!1},onError:()=>{y.value=!1}}))};return(c,s)=>(n(),P(z,null,{default:l(()=>[o(e(R),{title:`编辑用户 - ${c.user.name}`},null,8,["title"]),t("div",O,[t("div",Q,[t("div",Y,[t("div",Z,[t("div",ee,[t("div",se,[o(e(x),{variant:"outline",size:"icon",onClick:U},{default:l(()=>[o(e(J),{class:"h-4 w-4"})]),_:1}),s[12]||(s[12]=t("h1",{class:"text-2xl font-semibold"},"编辑用户",-1))])]),o(e(E),null,{default:l(()=>[o(e(T),null,{default:l(()=>[o(e(H),null,{default:l(()=>s[13]||(s[13]=[d("用户信息",-1)])),_:1,__:[13]}),o(e(L),null,{default:l(()=>s[14]||(s[14]=[d(" 编辑用户的基本信息和权限设置 ",-1)])),_:1,__:[14]})]),_:1}),o(e(G),null,{default:l(()=>[t("form",{onSubmit:q(F,["prevent"]),class:"space-y-6"},[t("div",re,[s[26]||(s[26]=t("h3",{class:"text-lg font-medium"},"基本信息",-1)),t("div",te,[o(e(p),null,{default:l(()=>s[15]||(s[15]=[d("头像",-1)])),_:1,__:[15]}),t("div",oe,[t("div",ae,[b.value?(n(),u("div",le,[t("img",{src:b.value,alt:"Avatar preview",class:"w-full h-full object-cover"},null,8,de)])):(n(),u("div",ie,[o(e(M),{class:"h-8 w-8 text-gray-400"})])),b.value?(n(),u("button",{key:2,type:"button",onClick:D,class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600"},[o(e(X),{class:"h-4 w-4"})])):f("",!0)]),t("div",ne,[t("input",{type:"file",id:"avatar",accept:"image/*",onChange:A,class:"hidden"},null,32),t("label",ue,[o(e(M),{class:"h-4 w-4 mr-2"}),s[16]||(s[16]=d(" 选择图片 ",-1))]),s[17]||(s[17]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," 支持 JPG, PNG, GIF 格式，最大 2MB ",-1))])]),e(r).errors.avatar?(n(),u("p",me,m(e(r).errors.avatar),1)):f("",!0)]),t("div",pe,[o(e(p),{for:"name"},{default:l(()=>s[18]||(s[18]=[d("姓名 *",-1)])),_:1,__:[18]}),o(e(g),{id:"name",modelValue:e(r).name,"onUpdate:modelValue":s[0]||(s[0]=a=>e(r).name=a),type:"text",required:"",class:_({"border-red-500":e(r).errors.name})},null,8,["modelValue","class"]),e(r).errors.name?(n(),u("p",fe,m(e(r).errors.name),1)):f("",!0)]),t("div",_e,[o(e(p),{for:"email"},{default:l(()=>s[19]||(s[19]=[d("邮箱 *",-1)])),_:1,__:[19]}),o(e(g),{id:"email",modelValue:e(r).email,"onUpdate:modelValue":s[1]||(s[1]=a=>e(r).email=a),type:"email",required:"",class:_({"border-red-500":e(r).errors.email})},null,8,["modelValue","class"]),e(r).errors.email?(n(),u("p",ge,m(e(r).errors.email),1)):f("",!0)]),t("div",ye,[o(e(p),{for:"login_name"},{default:l(()=>s[20]||(s[20]=[d("用户名 *",-1)])),_:1,__:[20]}),o(e(g),{id:"login_name",modelValue:e(r).login_name,"onUpdate:modelValue":s[2]||(s[2]=a=>e(r).login_name=a),type:"text",required:"",class:_({"border-red-500":e(r).errors.login_name})},null,8,["modelValue","class"]),s[21]||(s[21]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 用于登录的唯一用户名 ",-1)),e(r).errors.login_name?(n(),u("p",ce,m(e(r).errors.login_name),1)):f("",!0)]),t("div",be,[o(e(p),{for:"password"},{default:l(()=>s[22]||(s[22]=[d("新密码",-1)])),_:1,__:[22]}),o(e(g),{id:"password",modelValue:e(r).password,"onUpdate:modelValue":s[3]||(s[3]=a=>e(r).password=a),type:"password",autocomplete:"new-password",class:_({"border-red-500":e(r).errors.password})},null,8,["modelValue","class"]),s[23]||(s[23]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 留空表示不修改密码 ",-1)),e(r).errors.password?(n(),u("p",ve,m(e(r).errors.password),1)):f("",!0)]),t("div",xe,[o(e(p),{for:"password_confirmation"},{default:l(()=>s[24]||(s[24]=[d("确认新密码",-1)])),_:1,__:[24]}),o(e(g),{id:"password_confirmation",modelValue:e(r).password_confirmation,"onUpdate:modelValue":s[4]||(s[4]=a=>e(r).password_confirmation=a),type:"password",autocomplete:"new-password",class:_({"border-red-500":e(r).errors.password_confirmation})},null,8,["modelValue","class"]),s[25]||(s[25]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 请再次输入新密码 ",-1)),e(r).errors.password_confirmation?(n(),u("p",ke,m(e(r).errors.password_confirmation),1)):f("",!0)])]),t("div",we,[s[33]||(s[33]=t("h3",{class:"text-lg font-medium"},"账户设置",-1)),t("div",Ve,[o(e(p),{for:"type"},{default:l(()=>s[27]||(s[27]=[d("用户类型",-1)])),_:1,__:[27]}),v(t("select",{id:"type","onUpdate:modelValue":s[5]||(s[5]=a=>e(r).type=a),class:_(["w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":e(r).errors.type}])},s[28]||(s[28]=[t("option",{value:1},"普通用户",-1),t("option",{value:2},"高级用户",-1)]),2),[[C,e(r).type,void 0,{number:!0}]]),e(r).errors.type?(n(),u("p",Ue,m(e(r).errors.type),1)):f("",!0)]),t("div",$e,[o(e(p),{for:"status"},{default:l(()=>s[29]||(s[29]=[d("账户状态",-1)])),_:1,__:[29]}),v(t("select",{id:"status","onUpdate:modelValue":s[6]||(s[6]=a=>e(r).status=a),class:_(["w-full px-4 py-2 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":e(r).errors.status}])},s[30]||(s[30]=[t("option",{value:1},"正常",-1),t("option",{value:2},"暂停",-1),t("option",{value:3},"禁止",-1)]),2),[[C,e(r).status,void 0,{number:!0}]]),e(r).errors.status?(n(),u("p",Ce,m(e(r).errors.status),1)):f("",!0)]),t("div",Be,[o(e(p),{for:"credits"},{default:l(()=>s[31]||(s[31]=[d("金币余额",-1)])),_:1,__:[31]}),o(e(g),{id:"credits",modelValue:e(r).credits,"onUpdate:modelValue":s[7]||(s[7]=a=>e(r).credits=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",class:_({"border-red-500":e(r).errors.credits})},null,8,["modelValue","class"]),e(r).errors.credits?(n(),u("p",Me,m(e(r).errors.credits),1)):f("",!0)]),t("div",Se,[o(e(p),{for:"balance"},{default:l(()=>s[32]||(s[32]=[d("积分余额",-1)])),_:1,__:[32]}),o(e(g),{id:"balance",modelValue:e(r).balance,"onUpdate:modelValue":s[8]||(s[8]=a=>e(r).balance=a),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",class:_({"border-red-500":e(r).errors.balance})},null,8,["modelValue","class"]),e(r).errors.balance?(n(),u("p",Ae,m(e(r).errors.balance),1)):f("",!0)])]),t("div",De,[s[37]||(s[37]=t("h3",{class:"text-lg font-medium"},"权限设置",-1)),t("div",Fe,[v(t("input",{id:"is_creator","onUpdate:modelValue":s[9]||(s[9]=a=>e(r).is_creator=a),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[w,e(r).is_creator]]),o(e(p),{for:"is_creator",class:"cursor-pointer"},{default:l(()=>s[34]||(s[34]=[d(" 创作者权限 ",-1)])),_:1,__:[34]})]),s[38]||(s[38]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 pl-6"}," 可以发布和管理内容 ",-1)),t("div",Ne,[v(t("input",{id:"is_verified","onUpdate:modelValue":s[10]||(s[10]=a=>e(r).is_verified=a),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[w,e(r).is_verified]]),o(e(p),{for:"is_verified",class:"cursor-pointer"},{default:l(()=>s[35]||(s[35]=[d(" 已认证 ",-1)])),_:1,__:[35]})]),s[39]||(s[39]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 pl-6"}," 显示认证标识，表示身份已验证 ",-1)),t("div",he,[v(t("input",{id:"is_top_creator","onUpdate:modelValue":s[11]||(s[11]=a=>e(r).is_top_creator=a),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[w,e(r).is_top_creator]]),o(e(p),{for:"is_top_creator",class:"cursor-pointer"},{default:l(()=>s[36]||(s[36]=[d(" 顶级创作者 ",-1)])),_:1,__:[36]})]),s[40]||(s[40]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 pl-6"}," 显示特殊标识，表示优质创作者 ",-1))]),t("div",je,[s[42]||(s[42]=t("h3",{class:"text-sm font-medium mb-2"},"用户信息",-1)),t("div",Ie,[t("p",null,[s[41]||(s[41]=d("用户ID: ",-1)),t("span",Pe,m(c.user.id),1)])])]),t("div",Re,[o(e(x),{type:"submit",disabled:e(r).processing},{default:l(()=>[d(m(e(r).processing?"保存中...":"保存更改"),1)]),_:1},8,["disabled"]),o(e(x),{type:"button",variant:"outline",onClick:U},{default:l(()=>s[43]||(s[43]=[d(" 取消 ",-1)])),_:1,__:[43]}),o(e(x),{type:"button",variant:"destructive",onClick:N,disabled:y.value},{default:l(()=>[o(e(K),{class:_([{"animate-spin":y.value},"mr-2 h-4 w-4"])},null,8,["class"]),d(" "+m(y.value?"计算中...":"重新计算余额"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])])])])]),_:1}))}});export{ps as default};
