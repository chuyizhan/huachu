import{d as ie,O as re,C as M,u as ne,r as f,c as w,o as r,w as a,a as s,b as o,e,h as de,t as p,f as d,n as O,k as X,i as u,F as N,s as q,q as ue,p as ce,j as c,x as pe,m as fe}from"./app-CFL_GZH1.js";import{_ as me}from"./WebLayout.vue_vue_type_script_setup_true_lang-DeayNur6.js";import{_ as F}from"./index-0OA63zqw.js";import{_ as k,a as V}from"./CardContent.vue_vue_type_script_setup_true_lang-DjfNcLf_.js";import{_ as B}from"./CardHeader.vue_vue_type_script_setup_true_lang-fNBdkURJ.js";import{_ as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-BpZn79az.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-NfgSxyCe.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-yIqgXxxA.js";import{_ as G}from"./index-56XjcN_u.js";import{_ as S}from"./InputError.vue_vue_type_script_setup_true_lang-9fPNLHfF.js";import{v as ge,p as _e,a as ve,b as be,c as xe,d as ye,e as he,I as we,V as ke,S as Ve,f as Be}from"./filepond-plugin-image-transform.esm-OGBogAPj.js";import{F as Ce}from"./file-text-nOhPxSeZ.js";import{X as D}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-BPKBwA6u.js";import{T as Se}from"./tag-bTfdZrpc.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DoCvd7LC.js";import"./createLucideIcon-Bq3qRVEs.js";import"./heart-Cyocj_IG.js";import"./user-BPOTP8Nx.js";import"./Primitive-C2i5F4xy.js";import"./index-D_Yh8Atp.js";import"./useForwardExpose-D8U9gGaD.js";import"./usePrimitiveElement-BUs7f3Zt.js";import"./RovingFocusGroup-BGjUuGD1.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-C5W0E7bH.js";const Te={class:"min-h-screen py-8"},$e={class:"max-w-4xl mx-auto px-4"},Ue={class:"mb-8"},Fe={class:"text-[#999999]"},Pe={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ze={class:"lg:col-span-2 space-y-6"},Ee=["value"],je={class:"mt-2"},Re={key:0,class:"mt-2"},Le={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-[#4B5563] rounded-lg cursor-pointer hover:border-[#ff6e02] transition-colors bg-[#1c1c1c]"},Me={class:"flex flex-col items-center justify-center pt-5 pb-6"},Oe={key:1,class:"mt-2"},Ne={class:"relative bg-[#1c1c1c] rounded-lg overflow-hidden"},qe=["src"],Ge={key:0,class:"mt-2"},Ie={class:"flex items-center justify-between text-xs text-[#999999] mb-1"},Ae={class:"w-full bg-[#4B5563] rounded-full h-2"},Ke={key:1,class:"text-xs text-[#999999] mt-1"},Xe={key:0,class:"text-green-400 ml-2"},De={key:2,class:"text-xs text-red-400 mt-1"},Je={class:"flex gap-2 mb-3"},We={key:0,class:"flex flex-wrap gap-2"},He=["onClick"],Qe={class:"space-y-6"},Ye={key:0,class:"space-y-4"},Ze={key:0},et={class:"space-y-2 pt-4 border-t border-[#4B5563]"},tt={key:0,class:"flex items-center gap-2"},st={class:"text-lg"},lt={key:1,class:"text-white font-medium"},ot={key:2,class:"flex items-center gap-2"},at={class:"text-sm text-[#999999]"},it={key:3,class:"text-sm text-[#999999] line-clamp-3"},rt={key:4,class:"flex flex-wrap gap-1"},nt={key:0,class:"text-xs text-[#999999]"},jt=ie({__name:"Create",props:{categories:{}},setup(J){const W=ge(he,ye,xe,be,ve,_e),H=J,Q=re(),Y=M(()=>Q.props.auth?.user?.is_creator||!1),l=ne({title:"",content:"",post_category_id:"",type:"showcase",excerpt:"",images:[],video_temp_upload_id:null,videos:[],tags:[],is_premium:!1,price:null,free_after:null,status:"draft"}),T=f("");f("");const z=f(null),E=f(null),m=f(null),$=f(""),j=f(0),b=f(!1),v=f(0),x=f(null),Z=[{value:"discussion",label:"讨论",icon:"💬",description:"分享想法和观点"},{value:"tutorial",label:"教程",icon:"📖",description:"分享知识和技能"},{value:"showcase",label:"展示",icon:"🎨",description:"展示你的作品"},{value:"question",label:"问题",icon:"❓",description:"寻求帮助和建议"}],R=M(()=>H.categories.find(n=>n.id.toString()===l.post_category_id)),U=M(()=>Z.find(n=>n.value===l.type));function I(){const n=T.value.trim();n&&!l.tags.includes(n)&&(l.tags.push(n),T.value="")}function ee(n){l.tags.splice(n,1)}function te(){if(z.value){const n=z.value.getFiles();l.images=n.map(t=>t.file)}}async function se(n){const i=n.target.files?.[0];if(i){if(i.size>1024*1024*1024){alert("视频文件太大！最大支持1GB");return}if(!i.type.startsWith("video/")){alert("请上传有效的视频文件");return}$.value=i.name,j.value=i.size,m.value&&URL.revokeObjectURL(m.value),m.value=URL.createObjectURL(i),await le(i)}}async function le(n){b.value=!0,x.value=null,v.value=0;try{const t=await fetch("/api/v1/media/presigned-url",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({file_name:n.name,file_type:n.type,file_size:n.size,type:"video"})});if(!t.ok)throw new Error("获取上传链接失败");const{presigned_url:i,temp_upload_id:y,s3_path:K}=await t.json(),g=new XMLHttpRequest;if(g.upload.addEventListener("progress",h=>{h.lengthComputable&&(v.value=Math.round(h.loaded/h.total*95))}),await new Promise((h,L)=>{g.addEventListener("load",()=>{g.status===200?h(g.response):L(new Error("S3上传失败"))}),g.addEventListener("error",()=>L(new Error("网络错误"))),g.addEventListener("abort",()=>L(new Error("上传已取消"))),g.open("PUT",i),g.setRequestHeader("Content-Type",n.type),g.send(n)}),v.value=95,!(await fetch(`/api/v1/media/confirm-upload/${y}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({s3_path:K})})).ok)throw new Error("确认上传失败");l.video_temp_upload_id=y,v.value=100}catch(t){console.error("Video upload failed:",t),x.value=t instanceof Error?t.message:"视频上传失败，请重试",A()}finally{b.value=!1}}function A(){l.video_temp_upload_id=null,m.value&&(URL.revokeObjectURL(m.value),m.value=null),E.value&&(E.value.value=""),$.value="",j.value=0,x.value=null}function oe(){l.status="draft",l.post("/posts",{onSuccess:()=>{}})}function ae(){l.status="published",l.post("/posts",{onSuccess:()=>{}})}return(n,t)=>(r(),w(me,null,{default:a(()=>[s(e(de),{title:"创建新帖子"}),o("div",Te,[o("div",$e,[o("div",Ue,[t[6]||(t[6]=o("h1",{class:"text-3xl font-bold text-white mb-2"},"创建新帖子",-1)),o("p",Fe,"分享你的想法、经验或问题给"+p(n.$page.props.name),1)]),o("div",Pe,[o("div",ze,[s(e(k),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(C),{class:"text-white flex items-center gap-2"},{default:a(()=>[s(e(Ce),{class:"h-5 w-5"}),t[7]||(t[7]=d(" 基本信息 ",-1))]),_:1,__:[7]})]),_:1}),s(e(V),{class:"space-y-4"},{default:a(()=>[o("div",null,[s(e(_),{for:"title",class:"text-white"},{default:a(()=>t[8]||(t[8]=[d("标题 *",-1)])),_:1,__:[8]}),s(e(P),{id:"title",modelValue:e(l).title,"onUpdate:modelValue":t[0]||(t[0]=i=>e(l).title=i),placeholder:"输入帖子标题...",class:O(["mt-1 bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]",{"border-red-500":e(l).errors.title}])},null,8,["modelValue","class"]),s(S,{message:e(l).errors.title,class:"mt-1"},null,8,["message"])]),o("div",null,[s(e(_),{class:"text-white"},{default:a(()=>t[9]||(t[9]=[d("分类 *",-1)])),_:1,__:[9]}),X(o("select",{"onUpdate:modelValue":t[1]||(t[1]=i=>e(l).post_category_id=i),class:O(["mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02]",{"border-red-500":e(l).errors.post_category_id}])},[t[10]||(t[10]=o("option",{value:"",class:"text-[#999999]"},"选择分类",-1)),(r(!0),u(N,null,q(n.categories,i=>(r(),u("option",{key:i.id,value:i.id.toString(),class:"bg-[#1c1c1c] text-white"},p(i.name),9,Ee))),128))],2),[[ue,e(l).post_category_id]]),s(S,{message:e(l).errors.post_category_id,class:"mt-1"},null,8,["message"])]),o("div",null,[s(e(_),{for:"content",class:"text-white"},{default:a(()=>t[11]||(t[11]=[d("内容 *",-1)])),_:1,__:[11]}),X(o("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=i=>e(l).content=i),placeholder:"写下你的内容...",rows:"12",class:O(["mt-1 w-full bg-[#1c1c1c] border border-[#4B5563] text-white placeholder:text-[#999999] rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff6e02] focus:border-[#ff6e02] resize-y",{"border-red-500":e(l).errors.content}])},null,2),[[ce,e(l).content]]),s(S,{message:e(l).errors.content,class:"mt-1"},null,8,["message"])])]),_:1})]),_:1}),s(e(k),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(C),{class:"text-white flex items-center gap-2"},{default:a(()=>[s(e(we),{class:"h-5 w-5"}),t[12]||(t[12]=d(" 媒体内容 ",-1))]),_:1,__:[12]})]),_:1}),s(e(V),{class:"space-y-4"},{default:a(()=>[o("div",null,[s(e(_),{class:"text-white"},{default:a(()=>t[13]||(t[13]=[d("图片 (最多12张)",-1)])),_:1,__:[13]}),o("div",je,[s(e(W),{ref_key:"pond",ref:z,name:"images","allow-multiple":!0,"max-files":12,"accepted-file-types":"image/jpeg, image/jpg, image/png, image/gif, image/webp","max-file-size":"5MB","label-idle":"拖放图片或 <span class='filepond--label-action'>浏览</span>","label-file-loading":"加载中","label-file-processing":"上传中","label-tap-to-cancel":"点击取消","label-tap-to-retry":"点击重试","label-tap-to-undo":"点击撤销","image-resize-target-width":1200,"image-resize-target-height":900,"image-resize-mode":"contain","image-resize-upscale":"false","image-transform-output-quality":85,"image-transform-output-quality-mode":"always",onUpdatefiles:te,"style-panel-layout":"compact","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom"},null,512)]),t[14]||(t[14]=o("p",{class:"text-xs text-[#999999] mt-2"},"支持 JPG, PNG, GIF, WebP，单张最大5MB。图片将自动优化。",-1)),s(S,{message:e(l).errors.images,class:"mt-1"},null,8,["message"])]),o("div",null,[s(e(_),{class:"text-white"},{default:a(()=>t[15]||(t[15]=[d("视频 (可选)",-1)])),_:1,__:[15]}),m.value?c("",!0):(r(),u("div",Re,[o("label",Le,[o("div",Me,[s(e(ke),{class:"w-10 h-10 mb-3 text-[#999999]"}),t[16]||(t[16]=o("p",{class:"mb-2 text-sm text-[#999999]"},[o("span",{class:"font-semibold text-[#ff6e02]"},"点击上传视频")],-1)),t[17]||(t[17]=o("p",{class:"text-xs text-[#999999]"},"支持 MP4, WebM, MOV (最大1GB)",-1))]),o("input",{ref_key:"videoInput",ref:E,type:"file",class:"hidden",accept:"video/*",onChange:se},null,544)])])),m.value?(r(),u("div",Oe,[o("div",Ne,[o("video",{src:m.value,controls:"",class:"w-full max-h-64 object-contain"},null,8,qe),b.value?c("",!0):(r(),w(e(F),{key:0,type:"button",size:"sm",variant:"ghost",onClick:A,class:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white"},{default:a(()=>[s(e(D),{class:"h-4 w-4"})]),_:1}))]),b.value?(r(),u("div",Ge,[o("div",Ie,[t[18]||(t[18]=o("span",null,"上传中...",-1)),o("span",null,p(v.value)+"%",1)]),o("div",Ae,[o("div",{class:"bg-[#ff6e02] h-2 rounded-full transition-all duration-300",style:pe({width:`${v.value}%`})},null,4)])])):c("",!0),!b.value&&$.value?(r(),u("p",Ke,[d(p($.value)+" ("+p((j.value/1024/1024).toFixed(2))+"MB) ",1),e(l).video_temp_upload_id?(r(),u("span",Xe,"✓ 已上传")):c("",!0)])):c("",!0),x.value?(r(),u("p",De,p(x.value),1)):c("",!0)])):c("",!0),s(S,{message:e(l).errors.video,class:"mt-1"},null,8,["message"])])]),_:1})]),_:1}),s(e(k),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(C),{class:"text-white flex items-center gap-2"},{default:a(()=>[s(e(Se),{class:"h-5 w-5"}),t[19]||(t[19]=d(" 标签 ",-1))]),_:1,__:[19]})]),_:1}),s(e(V),null,{default:a(()=>[o("div",Je,[s(e(P),{modelValue:T.value,"onUpdate:modelValue":t[3]||(t[3]=i=>T.value=i),placeholder:"输入标签...",class:"bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]",onKeyup:fe(I,["enter"])},null,8,["modelValue"]),s(e(F),{type:"button",onClick:I,class:"bg-[#ff6e02] hover:bg-[#e55a00] text-white"},{default:a(()=>t[20]||(t[20]=[d(" 添加 ",-1)])),_:1,__:[20]})]),e(l).tags.length>0?(r(),u("div",We,[(r(!0),u(N,null,q(e(l).tags,(i,y)=>(r(),w(e(G),{key:y,class:"bg-[#ff6e02]/20 text-[#ff6e02] border-[#ff6e02]/30"},{default:a(()=>[d(p(i)+" ",1),o("button",{type:"button",onClick:K=>ee(y),class:"ml-1 hover:text-red-300"},[s(e(D),{class:"h-3 w-3"})],8,He)]),_:2},1024))),128))])):c("",!0)]),_:1})]),_:1})]),o("div",Qe,[s(e(k),{class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(C),{class:"text-white"},{default:a(()=>t[21]||(t[21]=[d("发布设置",-1)])),_:1,__:[21]})]),_:1}),s(e(V),{class:"space-y-4"},{default:a(()=>[Y.value?(r(),u("div",Ye,[o("div",null,[s(e(_),{for:"price",class:"text-white flex items-center gap-2"},{default:a(()=>t[22]||(t[22]=[d(" 💰 内容定价 ",-1)])),_:1,__:[22]}),t[23]||(t[23]=o("p",{class:"text-xs text-[#999999] mb-2"},"设置用户需要支付的积分数量才能查看此帖子",-1)),s(e(P),{id:"price",modelValue:e(l).price,"onUpdate:modelValue":t[4]||(t[4]=i=>e(l).price=i),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",placeholder:"0 = 免费",class:"bg-[#1c1c1c] border-[#4B5563] text-white placeholder:text-[#999999]"},null,8,["modelValue"]),t[24]||(t[24]=o("p",{class:"text-xs text-[#999999] mt-1"},"留空或输入0表示免费",-1))]),e(l).price&&e(l).price>0?(r(),u("div",Ze,[s(e(_),{for:"free_after",class:"text-white flex items-center gap-2"},{default:a(()=>t[25]||(t[25]=[d(" ⏰ 免费开放时间 ",-1)])),_:1,__:[25]}),t[26]||(t[26]=o("p",{class:"text-xs text-[#999999] mb-2"},"设置该日期后此内容将自动变为免费",-1)),s(e(P),{id:"free_after",modelValue:e(l).free_after,"onUpdate:modelValue":t[5]||(t[5]=i=>e(l).free_after=i),type:"datetime-local",class:"bg-[#1c1c1c] border-[#4B5563] text-white"},null,8,["modelValue"]),t[27]||(t[27]=o("p",{class:"text-xs text-[#999999] mt-1"},"可选：留空表示永久收费",-1))])):c("",!0)])):c("",!0),o("div",et,[s(e(F),{type:"button",onClick:oe,disabled:e(l).processing,class:"w-full bg-[#4B5563] hover:bg-[#6B7280] text-white"},{default:a(()=>[s(e(Ve),{class:"h-4 w-4 mr-2"}),d(" "+p(e(l).processing?"保存中...":"保存草稿"),1)]),_:1},8,["disabled"]),s(e(F),{type:"button",onClick:ae,disabled:e(l).processing,class:"w-full bg-[#ff6e02] hover:bg-[#e55a00] text-white"},{default:a(()=>[s(e(Be),{class:"h-4 w-4 mr-2"}),d(" "+p(e(l).processing?"发布中...":"立即发布"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),e(l).title||R.value||U.value?(r(),w(e(k),{key:0,class:"bg-[#374151] border-[#4B5563]"},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(C),{class:"text-white"},{default:a(()=>t[28]||(t[28]=[d("预览",-1)])),_:1,__:[28]})]),_:1}),s(e(V),{class:"space-y-3"},{default:a(()=>[U.value?(r(),u("div",tt,[o("span",st,p(U.value.icon),1),s(e(G),{class:"bg-[#ff6e02]/20 text-[#ff6e02] border-[#ff6e02]/30"},{default:a(()=>[d(p(U.value.label),1)]),_:1})])):c("",!0),e(l).title?(r(),u("h3",lt,p(e(l).title),1)):c("",!0),R.value?(r(),u("div",ot,[t[29]||(t[29]=o("div",{class:"w-3 h-3 rounded-full bg-[#ff6e02]"},null,-1)),o("span",at,p(R.value.name),1)])):c("",!0),e(l).excerpt?(r(),u("p",it,p(e(l).excerpt),1)):c("",!0),e(l).tags.length>0?(r(),u("div",rt,[(r(!0),u(N,null,q(e(l).tags.slice(0,3),i=>(r(),w(e(G),{key:i,class:"text-xs bg-[#1c1c1c] text-[#999999]"},{default:a(()=>[d(" #"+p(i),1)]),_:2},1024))),128)),e(l).tags.length>3?(r(),u("span",nt," +"+p(e(l).tags.length-3)+" more ",1)):c("",!0)])):c("",!0)]),_:1})]),_:1})):c("",!0)])])])])]),_:1}))}});export{jt as default};
